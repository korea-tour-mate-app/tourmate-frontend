import React, { useState, useRef, useEffect } from 'react';
import { StyleSheet, View, Text, Image, TouchableOpacity, ActivityIndicator, Alert } from 'react-native';
import BottomSheet from '@gorhom/bottom-sheet';
import { StackNavigationProp } from '@react-navigation/stack';
import { useNavigation, RouteProp } from '@react-navigation/native';
import { GestureHandlerRootView } from 'react-native-gesture-handler';
import MapView, { Marker, Polyline, Callout } from 'react-native-maps';
import { useSelection } from '../../components/SelectionContext';
import { RootStackParamList } from '../navigation/navigationTypes';
import axios from 'axios';
import { ScrollView } from 'react-native-gesture-handler';
import { REACT_TMAP_API_KEY } from '@env';

type RouteScreenNavigationProp = StackNavigationProp<RootStackParamList, 'RouteScreen'>;
type RouteScreenRouteProp = RouteProp<RootStackParamList, 'RouteScreen'>;

interface DayData {
  id: number;
  title: string;
  img: any;
  travelTime?: string;
}

interface RouteOptResponseDto {
  totalDistance: string;
  totalTime: string;
  totalFare: string;
  visitPlaces: {
    order: string;
    name: string;
    latitude: number;
    longitude: number;
  }[];
  paths: {
    coordinates: number[][];
    name: string;
  }[];
}

// TransportInfo 타입 재정의
interface TransportInfo {
  mode?: string;        // 교통수단 종류
  route?: string;       // 버스/지하철 번호
  routeColor?: string | null; // 교통수단 색상 (선택적)

  startLocation?: {
    name?: string;
    lon?: number;
    lat?: number;
  };  // 출발지 정보

  endLocation?: {
    name?: string;
    lon?: number;
    lat?: number;
  };
  
  sectionTime?: number;   // 소요 시간

  passStopList?: {
    index?: number;
    stationName?: string;
    lon?: number;
    lat?: number;
    stationID?: string;
  }[];  // 정류장 리스트

  passShape?: {
    latitude?: number;
    longitude?: number;
  }[];

  steps?: {
    streetName?: string;
    distance?: number;
    // description?: string;
    linestring?: {
      latitude?: number;
      longitude?: number;
    }[];
  }[];  // 도보 경로 세부 정보 (WALK일 때만 사용)

  totalTime?: number | null;    // 전체 소요시간 (초)
  transferCount?: number | null; // 환승 횟수
  totalWalkTime?: number | null; // 총 보행시간 (초)
  totalDistance?: number | null; // 총 이동거리 (m)
  totalFare?: number | null;     // 대중교통 요금
}

// Leg 타입 정의 
interface Leg {
  mode?: string;                      // 교통수단 종류
  route?: string;                    // 대중교통 노선 (버스/지하철 번호, 선택적)
  routeColor?: string | null;        // 노선 색상 (선택적)
  type?: number | null;              // 교통수단 타입 (선택적)
  start?: {
    name?: string;                    // 출발지명
    lon?: number;                     // 경도
    lat?: number;                     // 위도
  };
  end?: {
    name?: string;                    // 도착지명
    lon?: number;                     // 경도
    lat?: number;                     // 위도
  };
  passStopList?: {
    stationList?: Station[];   // 정류장 리스트
  };
  passShape?: {
    linestring?: string;
  };
  sectionTime?: number;               // 소요 시간 (초)

  steps?:{
    streetName?: string,
    distance?: number,
    // description?: string,
    linestring?: string
  }[]; // 도보 경로 (배열)
}

interface Station {
  index?: number;
  stationName?: string;  // 정류장 이름
  lon?: string;          // 경도
  lat?: string;          // 위도
  stationID?: string;   // 정류장 ID (선택적)
}

interface Fare {
  regular?: {
    totalFare?: number;
  };
}

// Itinerary 타입 정의
interface Itinerary {
  legs?: Leg[];                       // 교통수단 배열
  totalTime?: number | null;         // 전체 소요시간 (초, 선택적)
  transferCount?: number | null;     // 환승 횟수 (선택적)
  totalWalkTime?: number | null;     // 총 보행시간 (초, 선택적)
  totalDistance?: number | null;     // 총 이동거리 (m, 선택적)
  fare?: Fare; // fare 속성 추가
}

const RouteScreen = () => {
  const navigation = useNavigation<RouteScreenNavigationProp>();

  // const [selectedDay, setSelectedDay] = useState("1일차");
  const [selectedDayIndex, setSelectedDayIndex] = useState(0); // 현재 선택된 일차 (0일차부터 시작)
  const [selectedLocation, setSelectedLocation] = useState({ latitude: 40.54523875839218, longitude: 126.977613738705 });
  const [routeInfoByDay, setRouteInfoByDay] = useState<{ [day: string]: Omit<RouteOptResponseDto, 'paths'> }>({});
  const [mapPathsByDay, setMapPathsByDay] = useState<{ [day: string]: RouteOptResponseDto['paths'] }>({});
  // const [selectedDay, setSelectedDay] = useState("1일차");
  const bottomSheetRef = useRef<BottomSheet>(null);
  const mapRef = useRef<MapView>(null);
  const [toggleState, setToggleState] = useState<{ [key: string]: boolean }>({});
  const [transportInfo, setTransportInfo] = useState<TransportInfo[][][]>([]);

  const response1 = {
    "totalDistance": "8299",
    "totalTime": "2382",
    "totalFare": "0",
    "visitPlaces": [
      {
        "order": "0",
        "name": "서울역",
        "latitude": 37.55496651,
        "longitude": 126.97071928
      },
      {
        "order": "1",
        "name": "남대문시장",
        "latitude": 37.55996327,
        "longitude": 126.9770019
      },
      {
        "order": "2",
        "name": "명동",
        "latitude": 37.56421292,
        "longitude": 126.98530102
      },
      {
        "order": "3",
        "name": "광장시장",
        "latitude": 37.5708068,
        "longitude": 126.99649426
      },
      {
        "order": "4",
        "name": "동대문디자인플라자",
        "latitude": 37.56653255,
        "longitude": 127.0105931
      }
    ],
    "paths": [
      {
        "coordinates": [
          [
            37.55506649,
            126.96996657
          ],
          [
            37.55506648,
            126.96977214
          ],
          [
            37.55514703,
            126.96972492
          ],
          [
            37.55520535,
            126.96968326
          ],
          [
            37.55525535,
            126.96959437
          ],
          [
            37.55528312,
            126.96947494
          ],
          [
            37.55530533,
            126.96911108
          ],
          [
            37.55541365,
            126.96911664
          ],
          [
            37.55637187,
            126.96914161
          ],
          [
            37.55679127,
            126.96914993
          ],
          [
            37.55684404,
            126.96915548
          ],
          [
            37.55706346,
            126.96917492
          ],
          [
            37.55728288,
            126.96919435
          ],
          [
            37.55759951,
            126.96924712
          ],
          [
            37.55803002,
            126.96933043
          ],
          [
            37.55822444,
            126.96933876
          ],
          [
            37.55843275,
            126.9693332
          ],
          [
            37.55867161,
            126.96932486
          ],
          [
            37.55945208,
            126.96933317
          ],
          [
            37.55945763,
            126.96938594
          ],
          [
            37.55945763,
            126.96941372
          ],
          [
            37.55946041,
            126.96943871
          ],
          [
            37.55956876,
            126.97102468
          ],
          [
            37.55956876,
            126.97103857
          ],
          [
            37.55958265,
            126.97124132
          ],
          [
            37.55931602,
            126.97130244
          ],
          [
            37.55831614,
            126.97152467
          ],
          [
            37.55798562,
            126.97159689
          ],
          [
            37.5578162,
            126.97164689
          ],
          [
            37.55767177,
            126.97169689
          ],
          [
            37.55751623,
            126.97176633
          ],
          [
            37.55747735,
            126.97179133
          ],
          [
            37.55741069,
            126.97183578
          ],
          [
            37.55740236,
            126.97184689
          ],
          [
            37.55722738,
            126.9720802
          ],
          [
            37.55713851,
            126.97223297
          ],
          [
            37.55706352,
            126.97241907
          ],
          [
            37.55735516,
            126.97293568
          ],
          [
            37.5576468,
            126.97317176
          ],
          [
            37.55785233,
            126.9733384
          ],
          [
            37.55788011,
            126.9733634
          ],
          [
            37.55816619,
            126.9736217
          ],
          [
            37.55838284,
            126.97380779
          ],
          [
            37.55849949,
            126.97390778
          ],
          [
            37.5585967,
            126.97399388
          ],
          [
            37.55867447,
            126.97406054
          ],
          [
            37.55907443,
            126.97440216
          ],
          [
            37.55919664,
            126.9745077
          ],
          [
            37.55932163,
            126.97457436
          ],
          [
            37.55946328,
            126.97463268
          ],
          [
            37.55989657,
            126.97476322
          ],
          [
            37.56003544,
            126.97482154
          ],
          [
            37.56011321,
            126.9748882
          ],
          [
            37.56017987,
            126.97496319
          ],
          [
            37.56022153,
            126.97502429
          ],
          [
            37.56025486,
            126.97508262
          ],
          [
            37.56034653,
            126.9754187
          ],
          [
            37.56031597,
            126.97550758
          ],
          [
            37.56028265,
            126.97557147
          ],
          [
            37.56023543,
            126.97562979
          ],
          [
            37.56016877,
            126.97567424
          ],
          [
            37.56004101,
            126.9757409
          ],
          [
            37.55990492,
            126.97572979
          ],
          [
            37.55970772,
            126.97571869
          ],
          [
            37.55946885,
            126.97570481
          ],
          [
            37.5593522,
            126.97569648
          ],
          [
            37.55921611,
            126.97570759
          ],
          [
            37.5590439,
            126.97574648
          ],
          [
            37.55894669,
            126.97578259
          ],
          [
            37.55888004,
            126.97581037
          ],
          [
            37.55869673,
            126.97588537
          ],
          [
            37.55862173,
            126.97591593
          ],
          [
            37.55848842,
            126.97597426
          ],
          [
            37.55862173,
            126.97591593
          ],
          [
            37.55869673,
            126.97588537
          ],
          [
            37.55888004,
            126.97581037
          ],
          [
            37.55894669,
            126.97578259
          ],
          [
            37.5590439,
            126.97574648
          ],
          [
            37.55921611,
            126.97570759
          ],
          [
            37.5593522,
            126.97569648
          ],
          [
            37.55946885,
            126.97570481
          ],
          [
            37.55970772,
            126.97571869
          ],
          [
            37.55990492,
            126.97572979
          ],
          [
            37.55991047,
            126.97582979
          ],
          [
            37.55993547,
            126.97610198
          ],
          [
            37.55997158,
            126.97629085
          ],
          [
            37.56002992,
            126.97653805
          ],
          [
            37.56012991,
            126.97696023
          ]
        ],
        "name": "[0] 남대문시장"
      },
      {
        "coordinates": [
          [
            37.56012991,
            126.97696023
          ],
          [
            37.56021602,
            126.97730742
          ],
          [
            37.5608465,
            126.97735462
          ],
          [
            37.56086595,
            126.97740739
          ],
          [
            37.56088817,
            126.97747961
          ],
          [
            37.56090761,
            126.9775546
          ],
          [
            37.56092428,
            126.97762682
          ],
          [
            37.56093539,
            126.97768514
          ],
          [
            37.56109094,
            126.9784934
          ],
          [
            37.56130205,
            126.97961829
          ],
          [
            37.56132149,
            126.97972106
          ],
          [
            37.56138815,
            126.98003214
          ],
          [
            37.56142982,
            126.9801849
          ],
          [
            37.56144093,
            126.98023767
          ],
          [
            37.56147982,
            126.98036544
          ],
          [
            37.56152426,
            126.98049876
          ],
          [
            37.56159092,
            126.9806793
          ],
          [
            37.56164092,
            126.98079595
          ],
          [
            37.56171313,
            126.9809376
          ],
          [
            37.56185479,
            126.98114869
          ],
          [
            37.56192978,
            126.98123757
          ],
          [
            37.56195478,
            126.98126534
          ],
          [
            37.56202699,
            126.98132922
          ],
          [
            37.56214087,
            126.98142088
          ],
          [
            37.56235196,
            126.98157086
          ],
          [
            37.56291856,
            126.9818847
          ],
          [
            37.56332685,
            126.98204857
          ],
          [
            37.56349906,
            126.98210411
          ],
          [
            37.56367959,
            126.9821541
          ],
          [
            37.56384902,
            126.98220409
          ],
          [
            37.56410732,
            126.98227908
          ],
          [
            37.56443784,
            126.98237351
          ],
          [
            37.56459616,
            126.98242072
          ],
          [
            37.56477392,
            126.98247071
          ],
          [
            37.56501,
            126.98253459
          ],
          [
            37.56546828,
            126.98264012
          ],
          [
            37.56556272,
            126.98265956
          ],
          [
            37.56579881,
            126.98304563
          ],
          [
            37.56602934,
            126.98336226
          ],
          [
            37.566071,
            126.98341225
          ],
          [
            37.56607934,
            126.98355113
          ],
          [
            37.56607656,
            126.98365945
          ],
          [
            37.56607379,
            126.9840983
          ],
          [
            37.5658877,
            126.98411775
          ],
          [
            37.56546553,
            126.98422609
          ],
          [
            37.56530166,
            126.98427331
          ],
          [
            37.56523501,
            126.98430664
          ],
          [
            37.5651989,
            126.98433164
          ],
          [
            37.56512669,
            126.98440663
          ],
          [
            37.56502115,
            126.98456773
          ],
          [
            37.56494338,
            126.98466495
          ],
          [
            37.56487394,
            126.98471772
          ],
          [
            37.56471285,
            126.98477328
          ],
          [
            37.56447677,
            126.9848455
          ],
          [
            37.56408793,
            126.98500939
          ]
        ],
        "name": "[0] 명동"
      },
      {
        "coordinates": [
          [
            37.56408793,
            126.98500939
          ],
          [
            37.56391017,
            126.98508716
          ],
          [
            37.5638574,
            126.98510938
          ],
          [
            37.56389074,
            126.98536769
          ],
          [
            37.56403517,
            126.9858982
          ],
          [
            37.56409073,
            126.98609818
          ],
          [
            37.56422127,
            126.98637315
          ],
          [
            37.56426016,
            126.98645369
          ],
          [
            37.56457402,
            126.98695919
          ],
          [
            37.56461291,
            126.9870814
          ],
          [
            37.56463513,
            126.9871814
          ],
          [
            37.56466013,
            126.98734527
          ],
          [
            37.56468513,
            126.98753136
          ],
          [
            37.56477401,
            126.98768412
          ],
          [
            37.56480456,
            126.98768134
          ],
          [
            37.56484067,
            126.98767857
          ],
          [
            37.56531283,
            126.98765911
          ],
          [
            37.56606275,
            126.98763131
          ],
          [
            37.56607386,
            126.98763131
          ],
          [
            37.56615718,
            126.98762576
          ],
          [
            37.56669878,
            126.98764241
          ],
          [
            37.5671654,
            126.98766461
          ],
          [
            37.56783199,
            126.98769792
          ],
          [
            37.56789587,
            126.98773681
          ],
          [
            37.56792087,
            126.98776736
          ],
          [
            37.56793753,
            126.98780624
          ],
          [
            37.56795975,
            126.9878979
          ],
          [
            37.56796254,
            126.9886145
          ],
          [
            37.56798199,
            126.98893947
          ],
          [
            37.568007,
            126.9895422
          ],
          [
            37.56804034,
            126.99008381
          ],
          [
            37.56808201,
            126.99071431
          ],
          [
            37.56809035,
            126.99084763
          ],
          [
            37.56820147,
            126.99210307
          ],
          [
            37.56822647,
            126.99239193
          ],
          [
            37.56831259,
            126.99340572
          ],
          [
            37.56834037,
            126.99385013
          ],
          [
            37.56834593,
            126.99390568
          ],
          [
            37.5683876,
            126.99459728
          ],
          [
            37.5684126,
            126.99493336
          ],
          [
            37.56841816,
            126.99501668
          ],
          [
            37.56842372,
            126.99507501
          ],
          [
            37.56842927,
            126.99514723
          ],
          [
            37.56843761,
            126.99526666
          ],
          [
            37.56845428,
            126.99551942
          ],
          [
            37.56847094,
            126.99565829
          ],
          [
            37.56852095,
            126.99630268
          ],
          [
            37.56868762,
            126.99776643
          ],
          [
            37.56869596,
            126.99783586
          ],
          [
            37.56870429,
            126.9978803
          ],
          [
            37.56871262,
            126.9979303
          ],
          [
            37.56892373,
            126.99895798
          ],
          [
            37.56914317,
            127.00005509
          ],
          [
            37.56930705,
            127.00093001
          ],
          [
            37.56940705,
            127.00146329
          ],
          [
            37.5694515,
            127.00175771
          ],
          [
            37.56946261,
            127.0018327
          ],
          [
            37.56947372,
            127.00195491
          ],
          [
            37.56947928,
            127.00208268
          ],
          [
            37.5695376,
            127.00207712
          ],
          [
            37.56972647,
            127.00206045
          ],
          [
            37.56975702,
            127.00205767
          ],
          [
            37.5697848,
            127.00205489
          ],
          [
            37.57014864,
            127.00202433
          ],
          [
            37.57036806,
            127.00200488
          ],
          [
            37.57040972,
            127.00199933
          ],
          [
            37.57092911,
            127.00194654
          ],
          [
            37.57107075,
            127.00184932
          ],
          [
            37.57107075,
            127.0018271
          ],
          [
            37.57104853,
            127.00145769
          ],
          [
            37.57098463,
            127.00057999
          ],
          [
            37.5709624,
            127.00028002
          ],
          [
            37.57093462,
            126.99988561
          ],
          [
            37.57092629,
            126.99977451
          ],
          [
            37.57089017,
            126.99926345
          ],
          [
            37.57085405,
            126.99841075
          ],
          [
            37.57082627,
            126.99806634
          ],
          [
            37.57081238,
            126.99788025
          ],
          [
            37.57080682,
            126.99781358
          ],
          [
            37.57080404,
            126.99775248
          ],
          [
            37.57080127,
            126.99772193
          ],
          [
            37.57079015,
            126.9975775
          ],
          [
            37.5707846,
            126.99748028
          ],
          [
            37.57074571,
            126.99709421
          ],
          [
            37.57074015,
            126.99704143
          ],
          [
            37.57071237,
            126.99648315
          ],
          [
            37.57080124,
            126.99646926
          ]
        ],
        "name": "[0] 광장시장"
      },
      {
        "coordinates": [
          [
            37.57081513,
            126.99646926
          ],
          [
            37.57082346,
            126.99646648
          ],
          [
            37.570954,
            126.99645537
          ],
          [
            37.57188445,
            126.99636646
          ],
          [
            37.57198721,
            126.99632758
          ],
          [
            37.57199277,
            126.99632758
          ],
          [
            37.57206221,
            126.99637757
          ],
          [
            37.57209276,
            126.99640257
          ],
          [
            37.57218442,
            126.99648033
          ],
          [
            37.57231496,
            126.99657199
          ],
          [
            37.57252327,
            126.99671364
          ],
          [
            37.57266492,
            126.99679418
          ],
          [
            37.57269547,
            126.99680251
          ],
          [
            37.57271492,
            126.99681084
          ],
          [
            37.5727538,
            126.99682195
          ],
          [
            37.57283712,
            126.99683584
          ],
          [
            37.57296211,
            126.99681917
          ],
          [
            37.57330374,
            126.99673861
          ],
          [
            37.57335374,
            126.99753576
          ],
          [
            37.57335375,
            126.99763297
          ],
          [
            37.57335931,
            126.99788017
          ],
          [
            37.57336209,
            126.99838013
          ],
          [
            37.57335099,
            126.99859677
          ],
          [
            37.57333156,
            126.99928838
          ],
          [
            37.57332878,
            126.99934393
          ],
          [
            37.57332045,
            126.99940226
          ],
          [
            37.57328712,
            126.99957446
          ],
          [
            37.57323991,
            126.99982167
          ],
          [
            37.57317326,
            127.00018275
          ],
          [
            37.57316493,
            127.00035495
          ],
          [
            37.57317048,
            127.0004855
          ],
          [
            37.57319549,
            127.00075769
          ],
          [
            37.5732066,
            127.0008799
          ],
          [
            37.57322049,
            127.00104378
          ],
          [
            37.57323994,
            127.00128542
          ],
          [
            37.57327049,
            127.00156317
          ],
          [
            37.57331216,
            127.00197425
          ],
          [
            37.57332327,
            127.00204646
          ],
          [
            37.57337605,
            127.00251586
          ],
          [
            37.57337883,
            127.00256308
          ],
          [
            37.57340661,
            127.00287972
          ],
          [
            37.57343717,
            127.00323802
          ],
          [
            37.57343995,
            127.00326024
          ],
          [
            37.57343995,
            127.00326857
          ],
          [
            37.57345384,
            127.00343244
          ],
          [
            37.57346495,
            127.00358243
          ],
          [
            37.57347051,
            127.0037713
          ],
          [
            37.57346496,
            127.00421848
          ],
          [
            37.57347052,
            127.00463233
          ],
          [
            37.5734872,
            127.00499063
          ],
          [
            37.57348998,
            127.00509618
          ],
          [
            37.57350387,
            127.00537671
          ],
          [
            37.57351776,
            127.00572668
          ],
          [
            37.57351498,
            127.00574334
          ],
          [
            37.57348999,
            127.00586555
          ],
          [
            37.57348166,
            127.00587111
          ],
          [
            37.57347332,
            127.00587944
          ],
          [
            37.57346499,
            127.00588777
          ],
          [
            37.57345666,
            127.00589888
          ],
          [
            37.57344833,
            127.00590999
          ],
          [
            37.57344277,
            127.00592388
          ],
          [
            37.57343722,
            127.00593777
          ],
          [
            37.57343444,
            127.00595443
          ],
          [
            37.57343166,
            127.00596832
          ],
          [
            37.57343166,
            127.0059961
          ],
          [
            37.57343444,
            127.00601832
          ],
          [
            37.57344,
            127.00603221
          ],
          [
            37.57344555,
            127.00605165
          ],
          [
            37.57345389,
            127.00606831
          ],
          [
            37.57345944,
            127.00607387
          ],
          [
            37.57346777,
            127.0060822
          ],
          [
            37.57347888,
            127.00609331
          ],
          [
            37.57349833,
            127.00610442
          ],
          [
            37.57351499,
            127.00611275
          ],
          [
            37.57354832,
            127.00618219
          ],
          [
            37.5735511,
            127.00619052
          ],
          [
            37.5735761,
            127.00625996
          ],
          [
            37.57359554,
            127.00643494
          ],
          [
            37.57360943,
            127.00653771
          ],
          [
            37.57361221,
            127.00663215
          ],
          [
            37.5736011,
            127.00671269
          ],
          [
            37.57358166,
            127.00677658
          ],
          [
            37.57353722,
            127.00691546
          ],
          [
            37.57352056,
            127.00696545
          ],
          [
            37.57349001,
            127.00701267
          ],
          [
            37.57331226,
            127.00717933
          ],
          [
            37.57324838,
            127.00724043
          ],
          [
            37.57313172,
            127.00735432
          ],
          [
            37.57308729,
            127.00740154
          ],
          [
            37.57299563,
            127.00748764
          ],
          [
            37.57282343,
            127.0076543
          ],
          [
            37.57278177,
            127.00769318
          ],
          [
            37.57217629,
            127.00817649
          ],
          [
            37.57132918,
            127.00891256
          ],
          [
            37.57121531,
            127.00899033
          ],
          [
            37.57104033,
            127.00909033
          ],
          [
            37.57088202,
            127.00917644
          ],
          [
            37.57080147,
            127.00922366
          ],
          [
            37.57077648,
            127.00923754
          ],
          [
            37.57073204,
            127.00926254
          ],
          [
            37.57045985,
            127.00944309
          ],
          [
            37.57037375,
            127.0094792
          ],
          [
            37.57017933,
            127.00952642
          ],
          [
            37.57007656,
            127.00954309
          ],
          [
            37.56993491,
            127.00957087
          ],
          [
            37.56985992,
            127.00958476
          ],
          [
            37.56970161,
            127.00960143
          ],
          [
            37.56967106,
            127.00960699
          ],
          [
            37.56962662,
            127.00979864
          ],
          [
            37.56962107,
            127.00993474
          ],
          [
            37.56960719,
            127.01027637
          ],
          [
            37.56960997,
            127.01082354
          ],
          [
            37.56961833,
            127.01217342
          ],
          [
            37.56902673,
            127.01219566
          ],
          [
            37.56892952,
            127.01220399
          ],
          [
            37.56841292,
            127.01230955
          ],
          [
            37.56816572,
            127.01234567
          ],
          [
            37.56810462,
            127.01236234
          ],
          [
            37.56804074,
            127.01238734
          ],
          [
            37.56794075,
            127.01243733
          ],
          [
            37.5678241,
            127.01249566
          ],
          [
            37.56772967,
            127.01254289
          ],
          [
            37.56766023,
            127.01257066
          ],
          [
            37.56758524,
            127.01259288
          ],
          [
            37.56746303,
            127.01261789
          ],
          [
            37.56744637,
            127.01261789
          ],
          [
            37.56735193,
            127.012604
          ],
          [
            37.56724639,
            127.01258456
          ],
          [
            37.56697698,
            127.01251791
          ],
          [
            37.56695198,
            127.01250958
          ],
          [
            37.56692698,
            127.01250402
          ],
          [
            37.56690754,
            127.01249847
          ],
          [
            37.56688532,
            127.01248458
          ],
          [
            37.56684921,
            127.01245958
          ],
          [
            37.56679644,
            127.01242348
          ],
          [
            37.56677144,
            127.01240681
          ],
          [
            37.56674645,
            127.01239015
          ],
          [
            37.56662424,
            127.01226516
          ],
          [
            37.56641592,
            127.01198742
          ],
          [
            37.56627427,
            127.01172911
          ],
          [
            37.56617983,
            127.01140137
          ],
          [
            37.56610483,
            127.01105418
          ],
          [
            37.56652144,
            127.01089862
          ]
        ],
        "name": "[0] 동대문디자인플라자"
      }
    ]
  } 
  
  const response3 = {
    "totalDistance": "5816",
    "totalTime": "1765",
    "totalFare": "0",
    "visitPlaces": [
      {
        "order": "0",
        "name": "숭례문",
        "latitude": 37.56100478,
        "longitude": 126.97520759
      },
      {
        "order": "1",
        "name": "운현궁",
        "latitude": 37.57438674,
        "longitude": 126.98551183
      },
      {
        "order": "2",
        "name": "경복궁",
        "latitude": 37.57961653,
        "longitude": 126.97688746
      }
    ],
    "paths": [
      {
        "coordinates": [
          [
            37.56085202,
            126.97554923
          ],
          [
            37.56085202,
            126.97554923
          ],
          [
            37.56076037,
            126.97549646
          ],
          [
            37.56071593,
            126.97546313
          ],
          [
            37.56067982,
            126.97536314
          ],
          [
            37.56063816,
            126.97525482
          ],
          [
            37.56062427,
            126.97514927
          ],
          [
            37.56060204,
            126.97484652
          ],
          [
            37.5606437,
            126.9747132
          ],
          [
            37.56071313,
            126.97454099
          ],
          [
            37.56103531,
            126.97388271
          ],
          [
            37.561863,
            126.97453818
          ],
          [
            37.56204076,
            126.97467983
          ],
          [
            37.56206298,
            126.97469094
          ],
          [
            37.5620852,
            126.97469649
          ],
          [
            37.5621102,
            126.97469927
          ],
          [
            37.5622574,
            126.97469371
          ],
          [
            37.56246293,
            126.97466871
          ],
          [
            37.56248793,
            126.97465482
          ],
          [
            37.56254348,
            126.97460205
          ],
          [
            37.56263791,
            126.97449094
          ],
          [
            37.56269901,
            126.97441595
          ],
          [
            37.56306841,
            126.97416874
          ],
          [
            37.56329617,
            126.97473812
          ],
          [
            37.5634045,
            126.97501309
          ],
          [
            37.56391557,
            126.9763324
          ],
          [
            37.56401834,
            126.97662126
          ],
          [
            37.56403501,
            126.97668792
          ],
          [
            37.56404056,
            126.9767768
          ],
          [
            37.56399891,
            126.97702401
          ],
          [
            37.56437664,
            126.97715732
          ],
          [
            37.56460717,
            126.97723786
          ],
          [
            37.56467939,
            126.97725174
          ],
          [
            37.56494325,
            126.97730173
          ],
          [
            37.56510989,
            126.97732395
          ],
          [
            37.56518766,
            126.97733228
          ],
          [
            37.56526821,
            126.97733505
          ],
          [
            37.56535987,
            126.97733783
          ],
          [
            37.56558484,
            126.97732949
          ],
          [
            37.56623754,
            126.97727392
          ],
          [
            37.56703745,
            126.97725168
          ],
          [
            37.5672402,
            126.97724612
          ],
          [
            37.56801233,
            126.9772211
          ],
          [
            37.5687928,
            126.97722941
          ],
          [
            37.56901499,
            126.97723496
          ],
          [
            37.56925941,
            126.9772405
          ],
          [
            37.56947883,
            126.97724327
          ],
          [
            37.56965381,
            126.97724049
          ],
          [
            37.56981212,
            126.97723771
          ],
          [
            37.56994544,
            126.97724048
          ],
          [
            37.57006487,
            126.97724326
          ],
          [
            37.57012042,
            126.97724603
          ],
          [
            37.57030096,
            126.97724881
          ],
          [
            37.57088978,
            126.97727379
          ],
          [
            37.57151471,
            126.9772821
          ],
          [
            37.57163414,
            126.9772821
          ],
          [
            37.57189799,
            126.97727654
          ],
          [
            37.57225906,
            126.97727097
          ],
          [
            37.5725868,
            126.97725985
          ],
          [
            37.57262013,
            126.97725707
          ],
          [
            37.57272845,
            126.97724874
          ],
          [
            37.57285066,
            126.97723762
          ],
          [
            37.57342559,
            126.97722928
          ],
          [
            37.57426438,
            126.97721536
          ],
          [
            37.57440326,
            126.97721258
          ],
          [
            37.57479766,
            126.97720424
          ],
          [
            37.57516983,
            126.97719867
          ],
          [
            37.57520039,
            126.97725978
          ],
          [
            37.57525038,
            126.97736254
          ],
          [
            37.57544759,
            126.9776514
          ],
          [
            37.57552258,
            126.97780694
          ],
          [
            37.57557258,
            126.97797915
          ],
          [
            37.57560869,
            126.97833745
          ],
          [
            37.57566147,
            126.97886517
          ],
          [
            37.57572814,
            126.97924014
          ],
          [
            37.57577258,
            126.97945123
          ],
          [
            37.57583925,
            126.97987063
          ],
          [
            37.57584203,
            126.97996507
          ],
          [
            37.57582815,
            126.98019838
          ],
          [
            37.57575316,
            126.98081499
          ],
          [
            37.57565874,
            126.98146771
          ],
          [
            37.57557265,
            126.98201489
          ],
          [
            37.57552266,
            126.98242041
          ],
          [
            37.57550045,
            126.98270927
          ],
          [
            37.5754949,
            126.98283982
          ],
          [
            37.57548934,
            126.98293147
          ],
          [
            37.57550323,
            126.9830398
          ],
          [
            37.57553379,
            126.98319534
          ],
          [
            37.57555879,
            126.983287
          ],
          [
            37.57557823,
            126.98335366
          ],
          [
            37.57563934,
            126.98349809
          ],
          [
            37.57572266,
            126.98366751
          ],
          [
            37.57590321,
            126.98408969
          ],
          [
            37.57598653,
            126.98430078
          ],
          [
            37.57606986,
            126.98449798
          ],
          [
            37.57623651,
            126.9848535
          ],
          [
            37.57651705,
            126.985434
          ],
          [
            37.57657815,
            126.98557009
          ],
          [
            37.57665315,
            126.9857173
          ],
          [
            37.5766837,
            126.98590339
          ],
          [
            37.57668926,
            126.98600061
          ],
          [
            37.57668926,
            126.98605616
          ],
          [
            37.57668093,
            126.98609782
          ],
          [
            37.5766726,
            126.98613115
          ],
          [
            37.57665593,
            126.98616448
          ],
          [
            37.57658928,
            126.98624225
          ],
          [
            37.5765615,
            126.98625336
          ],
          [
            37.57655039,
            126.98625336
          ],
          [
            37.57653928,
            126.98625336
          ],
          [
            37.57643096,
            126.98623392
          ],
          [
            37.57640041,
            126.98623393
          ],
          [
            37.57637541,
            126.9862367
          ],
          [
            37.57628376,
            126.98626726
          ],
          [
            37.57622543,
            126.9862867
          ],
          [
            37.5757616,
            126.98644504
          ],
          [
            37.57567272,
            126.98647837
          ],
          [
            37.57561995,
            126.98649781
          ],
          [
            37.57499503,
            126.98674225
          ],
          [
            37.57496447,
            126.98675336
          ],
          [
            37.5748756,
            126.98679225
          ],
          [
            37.57456175,
            126.98693114
          ],
          [
            37.57453397,
            126.98679226
          ],
          [
            37.57449508,
            126.98659784
          ],
          [
            37.57442008,
            126.98623954
          ],
          [
            37.5743812,
            126.98604233
          ],
          [
            37.5743562,
            126.98593123
          ],
          [
            37.57417288,
            126.98557294
          ],
          [
            37.57432564,
            126.98543961
          ]
        ],
        "name": "[0] 운현궁"
      },
      {
        "coordinates": [
          [
            37.57432564,
            126.98543961
          ],
          [
            37.57417288,
            126.98557294
          ],
          [
            37.5743562,
            126.98593123
          ],
          [
            37.5743812,
            126.98604233
          ],
          [
            37.57442008,
            126.98623954
          ],
          [
            37.57449508,
            126.98659784
          ],
          [
            37.57453397,
            126.98679226
          ],
          [
            37.57456175,
            126.98693114
          ],
          [
            37.5741618,
            126.98714502
          ],
          [
            37.57410347,
            126.98717835
          ],
          [
            37.57369241,
            126.987445
          ],
          [
            37.57355632,
            126.98753111
          ],
          [
            37.57348966,
            126.98757
          ],
          [
            37.57322858,
            126.98767555
          ],
          [
            37.57317303,
            126.98769777
          ],
          [
            37.57310082,
            126.98770888
          ],
          [
            37.57302305,
            126.98772
          ],
          [
            37.57284807,
            126.98770334
          ],
          [
            37.57260088,
            126.98767835
          ],
          [
            37.57250644,
            126.98766446
          ],
          [
            37.57190929,
            126.98757004
          ],
          [
            37.57175653,
            126.98755338
          ],
          [
            37.57156766,
            126.98753394
          ],
          [
            37.57114827,
            126.98753951
          ],
          [
            37.57093162,
            126.98754229
          ],
          [
            37.57062055,
            126.98756452
          ],
          [
            37.57055945,
            126.9875673
          ],
          [
            37.57027337,
            126.98758398
          ],
          [
            37.57027337,
            126.98752009
          ],
          [
            37.57027335,
            126.98685904
          ],
          [
            37.57026779,
            126.98608411
          ],
          [
            37.57026222,
            126.98563415
          ],
          [
            37.57026222,
            126.98531474
          ],
          [
            37.57025942,
            126.98440927
          ],
          [
            37.57025664,
            126.98408152
          ],
          [
            37.57025385,
            126.98333436
          ],
          [
            37.57025107,
            126.98303995
          ],
          [
            37.57025384,
            126.98289829
          ],
          [
            37.57026494,
            126.98240945
          ],
          [
            37.57025937,
            126.98123733
          ],
          [
            37.57026492,
            126.98106235
          ],
          [
            37.570276,
            126.97971525
          ],
          [
            37.57028155,
            126.97929862
          ],
          [
            37.57048153,
            126.97930139
          ],
          [
            37.57112034,
            126.97930971
          ],
          [
            37.57125922,
            126.9793097
          ],
          [
            37.57139809,
            126.97930414
          ],
          [
            37.57142309,
            126.97930137
          ],
          [
            37.57150919,
            126.97929859
          ],
          [
            37.57231187,
            126.97926245
          ],
          [
            37.5724563,
            126.9792569
          ],
          [
            37.57248129,
            126.97895137
          ],
          [
            37.57251184,
            126.97883471
          ],
          [
            37.5725785,
            126.97869028
          ],
          [
            37.57260905,
            126.97865695
          ],
          [
            37.5726646,
            126.97859584
          ],
          [
            37.57267571,
            126.97859584
          ],
          [
            37.57268404,
            126.97859584
          ],
          [
            37.57269515,
            126.97859306
          ],
          [
            37.57270626,
            126.97859028
          ],
          [
            37.57271737,
            126.97858195
          ],
          [
            37.57272848,
            126.97857362
          ],
          [
            37.57273959,
            126.97856251
          ],
          [
            37.57287846,
            126.97855417
          ],
          [
            37.5731201,
            126.97854305
          ],
          [
            37.57362282,
            126.97852082
          ],
          [
            37.57424774,
            126.9784958
          ],
          [
            37.57426163,
            126.97850414
          ],
          [
            37.57428663,
            126.97851524
          ],
          [
            37.57428941,
            126.97853191
          ],
          [
            37.57429218,
            126.97854857
          ],
          [
            37.57429774,
            126.97856524
          ],
          [
            37.57430329,
            126.97857913
          ],
          [
            37.57431163,
            126.97859024
          ],
          [
            37.57431718,
            126.97859579
          ],
          [
            37.57432551,
            126.9786069
          ],
          [
            37.57433662,
            126.97861523
          ],
          [
            37.57434773,
            126.97862079
          ],
          [
            37.5743644,
            126.97862634
          ],
          [
            37.57437551,
            126.97862912
          ],
          [
            37.57438662,
            126.97862912
          ],
          [
            37.57440328,
            126.97862356
          ],
          [
            37.57441717,
            126.97861801
          ],
          [
            37.57442828,
            126.97861245
          ],
          [
            37.57443939,
            126.97860412
          ],
          [
            37.5744505,
            126.97859301
          ],
          [
            37.57445883,
            126.9785819
          ],
          [
            37.57446439,
            126.97856524
          ],
          [
            37.57453382,
            126.97854857
          ],
          [
            37.57463103,
            126.97857634
          ],
          [
            37.57473658,
            126.97862078
          ],
          [
            37.57477546,
            126.978643
          ],
          [
            37.57497266,
            126.97878742
          ],
          [
            37.57501155,
            126.97882353
          ],
          [
            37.57503377,
            126.97884575
          ],
          [
            37.57530874,
            126.97911794
          ],
          [
            37.57538373,
            126.97919848
          ],
          [
            37.57551983,
            126.97934847
          ],
          [
            37.57567259,
            126.97940957
          ],
          [
            37.57577258,
            126.97945123
          ],
          [
            37.57591423,
            126.97951233
          ],
          [
            37.57605866,
            126.97955399
          ],
          [
            37.57616976,
            126.97957065
          ],
          [
            37.57639473,
            126.97957064
          ],
          [
            37.5767197,
            126.97957341
          ],
          [
            37.57675858,
            126.97957341
          ],
          [
            37.57679191,
            126.97957341
          ],
          [
            37.57713354,
            126.97957896
          ],
          [
            37.57786123,
            126.97960116
          ],
          [
            37.57793067,
            126.97960393
          ],
          [
            37.57823897,
            126.97962614
          ],
          [
            37.57876946,
            126.9796539
          ],
          [
            37.57908609,
            126.97967334
          ],
          [
            37.5792944,
            126.97973166
          ],
          [
            37.57969158,
            126.97983997
          ],
          [
            37.57989711,
            126.97990663
          ],
          [
            37.57991377,
            126.97982052
          ],
          [
            37.57950271,
            126.97968443
          ],
          [
            37.57909442,
            126.97957612
          ]
        ],
        "name": "[0] 경복궁"
      }
    ]
  }

  const response2 = {
    "totalDistance": "11327",
    "totalTime": "1584",
    "totalFare": "0",
    "visitPlaces": [
      {
        "order": "0",
        "name": "한강공원 반포지구",
        "latitude": 37.51140815,
        "longitude": 126.9967237
      },
      {
        "order": "1",
        "name": "이태원",
        "latitude": 37.53458875,
        "longitude": 126.99463434
      },
      {
        "order": "2",
        "name": "전쟁기념관",
        "latitude": 37.53624102,
        "longitude": 126.97701646
      },
      {
        "order": "3",
        "name": "용산아이파크몰",
        "latitude": 37.52959435,
        "longitude": 126.96484275
      }
    ],
    "paths": [
      {
        "coordinates": [
          [
            37.51185811,
            126.9977347
          ],
          [
            37.51162203,
            126.99784581
          ],
          [
            37.5115526,
            126.99788192
          ],
          [
            37.51121375,
            126.99804581
          ],
          [
            37.51116376,
            126.99806803
          ],
          [
            37.51082769,
            126.99821802
          ],
          [
            37.51079714,
            126.99823469
          ],
          [
            37.51077769,
            126.99821525
          ],
          [
            37.5107527,
            126.99819581
          ],
          [
            37.51073048,
            126.9981847
          ],
          [
            37.51070826,
            126.99817636
          ],
          [
            37.51068048,
            126.99817359
          ],
          [
            37.51065271,
            126.99817914
          ],
          [
            37.51063326,
            126.9981847
          ],
          [
            37.51060271,
            126.99820692
          ],
          [
            37.51058605,
            126.99822081
          ],
          [
            37.51056661,
            126.99824581
          ],
          [
            37.5105555,
            126.99826803
          ],
          [
            37.51054439,
            126.99829025
          ],
          [
            37.51053606,
            126.99832635
          ],
          [
            37.51053328,
            126.99834858
          ],
          [
            37.51053328,
            126.99837357
          ],
          [
            37.51053328,
            126.99839579
          ],
          [
            37.51053884,
            126.99842079
          ],
          [
            37.51054717,
            126.99844857
          ],
          [
            37.51055828,
            126.99847079
          ],
          [
            37.51056939,
            126.99849023
          ],
          [
            37.5105805,
            126.99850412
          ],
          [
            37.51059716,
            126.99852356
          ],
          [
            37.51061661,
            126.99853744
          ],
          [
            37.5106416,
            126.99854855
          ],
          [
            37.51067216,
            126.99855689
          ],
          [
            37.51069993,
            126.99855688
          ],
          [
            37.51073604,
            126.99854855
          ],
          [
            37.51076659,
            126.99852911
          ],
          [
            37.51083603,
            126.99867631
          ],
          [
            37.51092769,
            126.99886796
          ],
          [
            37.51095269,
            126.99897073
          ],
          [
            37.51096935,
            126.9990485
          ],
          [
            37.51101935,
            126.99937069
          ],
          [
            37.5110388,
            126.99944291
          ],
          [
            37.51107768,
            126.99955123
          ],
          [
            37.51146654,
            127.00028448
          ],
          [
            37.5114832,
            127.00030948
          ],
          [
            37.51150542,
            127.00032892
          ],
          [
            37.51158319,
            127.00038169
          ],
          [
            37.51173318,
            127.00046224
          ],
          [
            37.51182483,
            127.00050668
          ],
          [
            37.51185816,
            127.00053445
          ],
          [
            37.51187483,
            127.00057056
          ],
          [
            37.51188872,
            127.00060944
          ],
          [
            37.51189983,
            127.00065666
          ],
          [
            37.51189705,
            127.00070666
          ],
          [
            37.5118915,
            127.00074832
          ],
          [
            37.51186928,
            127.00078998
          ],
          [
            37.51184428,
            127.00082331
          ],
          [
            37.51181651,
            127.00084553
          ],
          [
            37.5117804,
            127.0008622
          ],
          [
            37.51174707,
            127.00086498
          ],
          [
            37.51171374,
            127.00085942
          ],
          [
            37.51168319,
            127.00084276
          ],
          [
            37.51165264,
            127.00081499
          ],
          [
            37.51157764,
            127.00069278
          ],
          [
            37.51065272,
            126.99901796
          ],
          [
            37.51063883,
            126.99899851
          ],
          [
            37.51062495,
            126.99897629
          ],
          [
            37.51060828,
            126.99895685
          ],
          [
            37.51044163,
            126.99879298
          ],
          [
            37.51039441,
            126.99869577
          ],
          [
            37.51025276,
            126.99839302
          ],
          [
            37.51005833,
            126.99797918
          ],
          [
            37.51001389,
            126.99788197
          ],
          [
            37.51000278,
            126.99785697
          ],
          [
            37.5098139,
            126.99745701
          ],
          [
            37.50968336,
            126.99717926
          ],
          [
            37.50946949,
            126.99674042
          ],
          [
            37.50928894,
            126.99637935
          ],
          [
            37.50906396,
            126.99592384
          ],
          [
            37.50876121,
            126.99532946
          ],
          [
            37.50846123,
            126.99478507
          ],
          [
            37.50801127,
            126.99384628
          ],
          [
            37.50764463,
            126.99311024
          ],
          [
            37.50752242,
            126.9928686
          ],
          [
            37.50731133,
            126.99242143
          ],
          [
            37.50714745,
            126.9920548
          ],
          [
            37.50697246,
            126.99163262
          ],
          [
            37.50696135,
            126.99160207
          ],
          [
            37.50680303,
            126.99120489
          ],
          [
            37.50662249,
            126.99070494
          ],
          [
            37.50651971,
            126.99040774
          ],
          [
            37.50650582,
            126.98991335
          ],
          [
            37.50650026,
            126.98984391
          ],
          [
            37.50626415,
            126.98849404
          ],
          [
            37.50619749,
            126.98818296
          ],
          [
            37.50613916,
            126.98794409
          ],
          [
            37.5060725,
            126.98776911
          ],
          [
            37.50595584,
            126.98751913
          ],
          [
            37.50573641,
            126.98707196
          ],
          [
            37.50500314,
            126.98556934
          ],
          [
            37.5048837,
            126.9851055
          ],
          [
            37.50462815,
            126.98404449
          ],
          [
            37.50449482,
            126.98328067
          ],
          [
            37.50449482,
            126.98292237
          ],
          [
            37.50448648,
            126.98270017
          ],
          [
            37.5044337,
            126.98238631
          ],
          [
            37.50439759,
            126.982178
          ],
          [
            37.50438092,
            126.98204468
          ],
          [
            37.50437259,
            126.98192524
          ],
          [
            37.50436703,
            126.98169749
          ],
          [
            37.50436703,
            126.98146695
          ],
          [
            37.50438091,
            126.98110587
          ],
          [
            37.50438646,
            126.98097811
          ],
          [
            37.50439479,
            126.98091145
          ],
          [
            37.50441701,
            126.98084479
          ],
          [
            37.50447811,
            126.98074757
          ],
          [
            37.50450866,
            126.98071146
          ],
          [
            37.50454199,
            126.98068369
          ],
          [
            37.50457532,
            126.98066147
          ],
          [
            37.50461143,
            126.9806448
          ],
          [
            37.50471419,
            126.98062258
          ],
          [
            37.50496694,
            126.98062257
          ],
          [
            37.50559187,
            126.98059755
          ],
          [
            37.50600293,
            126.98070864
          ],
          [
            37.5061307,
            126.98074197
          ],
          [
            37.50641122,
            126.98082251
          ],
          [
            37.50656121,
            126.98086695
          ],
          [
            37.51132179,
            126.98212503
          ],
          [
            37.51261053,
            126.98247218
          ],
          [
            37.51393538,
            126.982811
          ],
          [
            37.51473807,
            126.98301652
          ],
          [
            37.51511581,
            126.9831165
          ],
          [
            37.51544633,
            126.98320815
          ],
          [
            37.51580184,
            126.98329702
          ],
          [
            37.51613792,
            126.98335256
          ],
          [
            37.51646566,
            126.98338588
          ],
          [
            37.51760997,
            126.98338029
          ],
          [
            37.51821545,
            126.98339139
          ],
          [
            37.51843487,
            126.98339971
          ],
          [
            37.51854597,
            126.98341082
          ],
          [
            37.51900425,
            126.98353857
          ],
          [
            37.51916257,
            126.98358856
          ],
          [
            37.51927922,
            126.98364689
          ],
          [
            37.51934033,
            126.98369411
          ],
          [
            37.51940699,
            126.98377465
          ],
          [
            37.51946532,
            126.98385798
          ],
          [
            37.51951253,
            126.98393574
          ],
          [
            37.51954309,
            126.98401907
          ],
          [
            37.51956809,
            126.98409962
          ],
          [
            37.51958197,
            126.98416072
          ],
          [
            37.51971254,
            126.98547449
          ],
          [
            37.51979309,
            126.98607999
          ],
          [
            37.51995698,
            126.98664937
          ],
          [
            37.51998198,
            126.98682158
          ],
          [
            37.52000975,
            126.98706878
          ],
          [
            37.52003754,
            126.98755207
          ],
          [
            37.52007921,
            126.98837977
          ],
          [
            37.52010978,
            126.98900749
          ],
          [
            37.52013478,
            126.98952688
          ],
          [
            37.52015146,
            126.99018238
          ],
          [
            37.52014869,
            126.99054901
          ],
          [
            37.52014591,
            126.99057679
          ],
          [
            37.52014036,
            126.99069622
          ],
          [
            37.52013481,
            126.99077955
          ],
          [
            37.52013203,
            126.99083232
          ],
          [
            37.52011259,
            126.99089898
          ],
          [
            37.52004593,
            126.99113785
          ],
          [
            37.52002927,
            126.99123507
          ],
          [
            37.51996818,
            126.99182668
          ],
          [
            37.51993763,
            126.99221276
          ],
          [
            37.51992097,
            126.99241829
          ],
          [
            37.51992654,
            126.99296824
          ],
          [
            37.51996265,
            126.9934932
          ],
          [
            37.51997377,
            126.9936904
          ],
          [
            37.51997932,
            126.99375706
          ],
          [
            37.51999043,
            126.99386261
          ],
          [
            37.5200071,
            126.99411814
          ],
          [
            37.52006821,
            126.994432
          ],
          [
            37.5201321,
            126.99466531
          ],
          [
            37.52022654,
            126.99494861
          ],
          [
            37.52034875,
            126.99530969
          ],
          [
            37.52066817,
            126.9961096
          ],
          [
            37.52090149,
            126.99667899
          ],
          [
            37.52096815,
            126.99684286
          ],
          [
            37.52099315,
            126.99690397
          ],
          [
            37.52131257,
            126.99768444
          ],
          [
            37.52138757,
            126.99787053
          ],
          [
            37.52139034,
            126.99788164
          ],
          [
            37.52139312,
            126.99788998
          ],
          [
            37.52157644,
            126.99833993
          ],
          [
            37.52182365,
            126.99893987
          ],
          [
            37.52203474,
            126.9994537
          ],
          [
            37.5221014,
            126.99960924
          ],
          [
            37.5221514,
            126.9997259
          ],
          [
            37.5222375,
            126.99991199
          ],
          [
            37.52232638,
            127.00007308
          ],
          [
            37.5223986,
            127.00020085
          ],
          [
            37.52247915,
            127.00033972
          ],
          [
            37.52257914,
            127.00049526
          ],
          [
            37.52268191,
            127.00063969
          ],
          [
            37.52280412,
            127.00080634
          ],
          [
            37.52292633,
            127.00095077
          ],
          [
            37.52302632,
            127.00106742
          ],
          [
            37.52317631,
            127.0012174
          ],
          [
            37.52336518,
            127.00138682
          ],
          [
            37.52353738,
            127.00153125
          ],
          [
            37.5237568,
            127.00169512
          ],
          [
            37.52464838,
            127.00225338
          ],
          [
            37.52470115,
            127.00228393
          ],
          [
            37.52485668,
            127.00218671
          ],
          [
            37.52514276,
            127.0019145
          ],
          [
            37.52591765,
            127.00115066
          ],
          [
            37.5261093,
            127.00098678
          ],
          [
            37.52616762,
            127.00093401
          ],
          [
            37.52623428,
            127.00086735
          ],
          [
            37.52625372,
            127.00085068
          ],
          [
            37.52642314,
            127.00067569
          ],
          [
            37.52650646,
            127.00059236
          ],
          [
            37.5267481,
            127.00036738
          ],
          [
            37.52678143,
            127.00033682
          ],
          [
            37.52712027,
            127.0000174
          ],
          [
            37.52775352,
            126.99942855
          ],
          [
            37.52807015,
            126.99913134
          ],
          [
            37.52852842,
            126.99869248
          ],
          [
            37.5289728,
            126.99827584
          ],
          [
            37.5291089,
            126.99811752
          ],
          [
            37.52916167,
            126.99804808
          ],
          [
            37.52927554,
            126.99788142
          ],
          [
            37.52928387,
            126.99787031
          ],
          [
            37.52931998,
            126.99781754
          ],
          [
            37.52946718,
            126.99763699
          ],
          [
            37.52987268,
            126.99725368
          ],
          [
            37.53001988,
            126.99708981
          ],
          [
            37.53010876,
            126.99699259
          ],
          [
            37.53017542,
            126.99692593
          ],
          [
            37.5302754,
            126.99682593
          ],
          [
            37.53031984,
            126.99678427
          ],
          [
            37.53035595,
            126.99674816
          ],
          [
            37.53042816,
            126.99674816
          ],
          [
            37.53065036,
            126.99675648
          ],
          [
            37.53118085,
            126.99669259
          ],
          [
            37.53122529,
            126.99668703
          ],
          [
            37.53132806,
            126.99667314
          ],
          [
            37.53138638,
            126.99664259
          ],
          [
            37.53161691,
            126.99649815
          ],
          [
            37.53181411,
            126.99637038
          ],
          [
            37.53184466,
            126.99635093
          ],
          [
            37.53185577,
            126.9963426
          ],
          [
            37.53206407,
            126.99620094
          ],
          [
            37.53222794,
            126.99608706
          ],
          [
            37.53250013,
            126.99590095
          ],
          [
            37.53252513,
            126.99588151
          ],
          [
            37.53268344,
            126.99577596
          ],
          [
            37.53279176,
            126.99570096
          ],
          [
            37.5328362,
            126.99567597
          ],
          [
            37.53297785,
            126.99560375
          ],
          [
            37.5330695,
            126.99557319
          ],
          [
            37.53313338,
            126.9955593
          ],
          [
            37.53317504,
            126.99555652
          ],
          [
            37.53331392,
            126.99556763
          ],
          [
            37.53354445,
            126.9955954
          ],
          [
            37.53358611,
            126.99559817
          ],
          [
            37.5340055,
            126.99563982
          ],
          [
            37.53415271,
            126.99562316
          ],
          [
            37.53418048,
            126.99562038
          ],
          [
            37.53434713,
            126.99560648
          ],
          [
            37.53458321,
            126.99558148
          ],
          [
            37.5345471,
            126.9949371
          ],
          [
            37.53452765,
            126.99463712
          ]
        ],
        "name": "[0] 이태원"
      },
      {
        "coordinates": [
          [
            37.53452765,
            126.99463712
          ],
          [
            37.53451931,
            126.99445381
          ],
          [
            37.53449153,
            126.99389275
          ],
          [
            37.53445819,
            126.99339557
          ],
          [
            37.53439429,
            126.99248732
          ],
          [
            37.53436651,
            126.99202625
          ],
          [
            37.53435817,
            126.99189571
          ],
          [
            37.5343165,
            126.99121522
          ],
          [
            37.53429983,
            126.99093469
          ],
          [
            37.5342915,
            126.99085136
          ],
          [
            37.53426093,
            126.99030141
          ],
          [
            37.53425816,
            126.99026253
          ],
          [
            37.5342526,
            126.99015976
          ],
          [
            37.53424704,
            126.99010421
          ],
          [
            37.53423038,
            126.98991534
          ],
          [
            37.53422482,
            126.9898209
          ],
          [
            37.53421648,
            126.98969314
          ],
          [
            37.5341637,
            126.98872101
          ],
          [
            37.53415536,
            126.9886349
          ],
          [
            37.53419146,
            126.98818217
          ],
          [
            37.53421645,
            126.98783497
          ],
          [
            37.53432477,
            126.9875961
          ],
          [
            37.53439142,
            126.98741834
          ],
          [
            37.53443031,
            126.98730724
          ],
          [
            37.53461916,
            126.98684339
          ],
          [
            37.53484968,
            126.98615455
          ],
          [
            37.53489412,
            126.98599623
          ],
          [
            37.53491633,
            126.98586569
          ],
          [
            37.534933,
            126.98568793
          ],
          [
            37.5349052,
            126.98469357
          ],
          [
            37.53485518,
            126.98296318
          ],
          [
            37.53484962,
            126.98268543
          ],
          [
            37.53484684,
            126.98263265
          ],
          [
            37.53484128,
            126.98240212
          ],
          [
            37.53478292,
            126.98068839
          ],
          [
            37.53478015,
            126.98063284
          ],
          [
            37.53477737,
            126.98049396
          ],
          [
            37.53474679,
            126.97920241
          ],
          [
            37.53474123,
            126.97892188
          ],
          [
            37.53473289,
            126.97867191
          ],
          [
            37.53468287,
            126.97724426
          ],
          [
            37.53464397,
            126.97608603
          ],
          [
            37.53464119,
            126.97599437
          ],
          [
            37.53465507,
            126.97580272
          ],
          [
            37.53497448,
            126.97591659
          ],
          [
            37.53500781,
            126.97592215
          ],
          [
            37.53505225,
            126.97592215
          ],
          [
            37.53530222,
            126.97590547
          ],
          [
            37.53534111,
            126.97589992
          ],
          [
            37.53536333,
            126.97589159
          ],
          [
            37.53537999,
            126.97587492
          ],
          [
            37.53539665,
            126.97586103
          ],
          [
            37.53547998,
            126.97576104
          ],
          [
            37.5356494,
            126.97554994
          ],
          [
            37.53566051,
            126.97553605
          ],
          [
            37.53567717,
            126.97552772
          ],
          [
            37.53568828,
            126.97552217
          ],
          [
            37.53570217,
            126.97552216
          ],
          [
            37.53596325,
            126.97550549
          ],
          [
            37.53616323,
            126.97549438
          ]
        ],
        "name": "[0] 전쟁기념관"
      },
      {
        "coordinates": [
          [
            37.53630765,
            126.97548604
          ],
          [
            37.53631876,
            126.97548048
          ],
          [
            37.53632987,
            126.97546937
          ],
          [
            37.53633265,
            126.97545826
          ],
          [
            37.5363382,
            126.97544438
          ],
          [
            37.53635209,
            126.97529717
          ],
          [
            37.53636598,
            126.97527495
          ],
          [
            37.53637986,
            126.97526384
          ],
          [
            37.53663261,
            126.97507773
          ],
          [
            37.53667982,
            126.97506662
          ],
          [
            37.53671315,
            126.97505829
          ],
          [
            37.53701312,
            126.97504162
          ],
          [
            37.53716866,
            126.97503328
          ],
          [
            37.53717977,
            126.97524159
          ],
          [
            37.53718811,
            126.97544435
          ],
          [
            37.53719922,
            126.97564711
          ],
          [
            37.53720756,
            126.97584987
          ],
          [
            37.53721867,
            126.97605818
          ],
          [
            37.53721867,
            126.97606929
          ],
          [
            37.53722422,
            126.9760804
          ],
          [
            37.53723256,
            126.97608318
          ],
          [
            37.53724089,
            126.97608596
          ],
          [
            37.537252,
            126.97608596
          ],
          [
            37.53757974,
            126.97606651
          ],
          [
            37.53771306,
            126.97605539
          ],
          [
            37.53770194,
            126.97563321
          ],
          [
            37.53768248,
            126.97499993
          ],
          [
            37.5376797,
            126.97484995
          ],
          [
            37.53765192,
            126.97421112
          ],
          [
            37.53764081,
            126.97404447
          ],
          [
            37.53761025,
            126.97380005
          ],
          [
            37.53747693,
            126.97383616
          ],
          [
            37.5364715,
            126.97406672
          ],
          [
            37.53633818,
            126.9740945
          ],
          [
            37.53621597,
            126.97409728
          ],
          [
            37.53616042,
            126.97409173
          ],
          [
            37.53608265,
            126.97407506
          ],
          [
            37.53582435,
            126.97396119
          ],
          [
            37.53578824,
            126.97394731
          ],
          [
            37.53565214,
            126.97385565
          ],
          [
            37.53521608,
            126.97344181
          ],
          [
            37.53487722,
            126.97311963
          ],
          [
            37.53404119,
            126.97236972
          ],
          [
            37.53314128,
            126.97152538
          ],
          [
            37.53229415,
            126.97071714
          ],
          [
            37.53222471,
            126.97065048
          ],
          [
            37.53209694,
            126.97052272
          ],
          [
            37.53208305,
            126.97051161
          ],
          [
            37.53162477,
            126.97007555
          ],
          [
            37.53138035,
            126.96985058
          ],
          [
            37.53047488,
            126.96896735
          ],
          [
            37.5301638,
            126.9686785
          ],
          [
            37.52984439,
            126.96836187
          ],
          [
            37.52961941,
            126.96813968
          ],
          [
            37.5295833,
            126.96810357
          ],
          [
            37.52819177,
            126.96673984
          ],
          [
            37.52791958,
            126.96647876
          ],
          [
            37.52753073,
            126.96610659
          ],
          [
            37.52749184,
            126.96607048
          ],
          [
            37.52801954,
            126.96516221
          ],
          [
            37.52816674,
            126.96493723
          ],
          [
            37.52820007,
            126.9649039
          ],
          [
            37.52828895,
            126.96484557
          ],
          [
            37.52830839,
            126.96481779
          ],
          [
            37.52833339,
            126.96477613
          ],
          [
            37.52870833,
            126.96416506
          ],
          [
            37.52883332,
            126.96428727
          ]
        ],
        "name": "[0] 용산아이파크몰"
      }
    ]
  }

  // SelectionContext에서 값 가져오기
  const {
    selectedThemes,
    selectedDay: contextSelectedDay,
    selectedWithWho,
    selectedBudget,
    selectedVehicle
  } = useSelection();

  useEffect(() => {
    console.log('Selected Themes:', selectedThemes);
    console.log('Selected Day:', contextSelectedDay);
    console.log('Selected WithWho:', selectedWithWho);
    console.log('Selected Budget:', selectedBudget);
    console.log('Selected Vehicle:', selectedVehicle);
  }, [selectedThemes, contextSelectedDay, selectedWithWho, selectedBudget, selectedVehicle]);

  const dayCount = Number(contextSelectedDay.at(-1)); // 며칠동안 여행을 가는지
  // const dayCount = contextSelectedDay[contextSelectedDay.length - 1]; // 같은 표현 // 마지막 값으로 여행 일 수 계산
  // console.log("여행일수는? ", dayCount);
  // const dayCount = 1; // 일단 api 호출은 한번으로 고정

  useEffect(() => {
    // let isMounted = true; // 컴포넌트 마운트 여부 추적

    const fetchRouteDataForEachDay = async () => {
      try {
        const newRouteInfoByDay: { [day: string]: Omit<RouteOptResponseDto, 'paths'> } = {};
        const newMapPathsByDay: { [day: string]: RouteOptResponseDto['paths'] } = {};

        // 각 날짜에 대해 API 호출
        for (let i = 0; i < dayCount; i++) {
          // TODO 데이터는 모델API에서 받아오는 걸로 나중에 수정
          // const requestBody = {
          //   startName: "숭례문", // ex. modelData[i][startName] 형태
          //   startX: "126.975208",
          //   startY: "37.561004",
          //   startTime: "202408251200",
          //   endName: "운현궁",
          //   endX: "126.985512",
          //   endY: "37.574385",
          //   viaPoints: [
          //     { viaPointId: "test01", viaPointName: "경복궁", viaX: "126.976889", viaY: "37.579617" },
          //     { viaPointId: "test02", viaPointName: "창덕궁", viaX: "126.991898", viaY: "37.579620" },
          //     { viaPointId: "test03", viaPointName: "남산서울타워", viaX: "126.988205", viaY: "37.551169" }
          //   ]
          // };

          // const response = await axios.post('http://10.0.2.2:8080/api/tmap/optimize-route', requestBody);
        
          let route_response;  // let을 사용하여 나중에 값을 할당할 수 있도록 함

          switch (i) {
            case 0:
              route_response = response1;
              break;
            case 1:
              route_response = response2;
              break;
            case 2:
              route_response = response3;
              break;
            default:
              route_response = response1;
          }

          // if (!isMounted) return; // 컴포넌트가 언마운트된 경우 종료
          // console.log(`Day ${i + 1} route data:`, response.data);
          console.log(`Day ${i + 1} route data:`, route_response);

          const { totalDistance, totalTime, totalFare, visitPlaces, paths } = route_response;
          // const { totalDistance, totalTime, totalFare, visitPlaces, paths } = response;

          const dayKey = `Day ${i + 1}`;

          newRouteInfoByDay[dayKey] = { totalDistance, totalTime, totalFare, visitPlaces };
          newMapPathsByDay[dayKey] = paths;
        }

        setRouteInfoByDay(newRouteInfoByDay);
        setMapPathsByDay(newMapPathsByDay);
      } catch (error) {
        console.error('Error fetching route data:', error);
        Alert.alert('Error', '경로 데이터를 불러오는 중 오류가 발생했습니다.');
      } finally {
      }
    };

    fetchRouteDataForEachDay();

    return () => {
      // isMounted = false; // 컴포넌트 언마운트 시 플래그 변경
    };
  }, []); // useEffect 의존성 배열 추가

  // 토글 상태 변경 함수  
  const toggleItem = (dayIndex: number, placeIndex: number) => {
    const toggleKey = `${dayIndex}-${placeIndex}`;    
    setToggleState((prevState) => {
      const newState = !prevState[toggleKey]; // 이전 상태를 기반으로 새로운 상태 계산
      
      if (newState && !transportInfo[dayIndex]?.[placeIndex]) {
        fetchTransportData(dayIndex, placeIndex);  // 토글이 true로 변경될 때만 API 호출
      }
      
      return {
        ...prevState,
        [toggleKey]: newState,
      };
    });
  };
  
  const handleLocationPress = (latitude: number, longitude: number) => {
    if (mapRef.current) { // ref가 있을 때만 실행
      mapRef.current.animateToRegion({
        latitude,
        longitude,
        latitudeDelta: 0.01,
        longitudeDelta: 0.01,
      }, 1000);
    }
  };

  const handleZoomIn = () => {
    if (mapRef.current) { // ref가 있을 때만 실행
      mapRef.current?.getCamera().then((camera) => {
        camera.zoom += 1; // 줌 인
        mapRef.current?.animateCamera(camera);
      });
    }
  };

  const handleZoomOut = () => {
    if (mapRef.current) { // ref가 있을 때만 실행
      mapRef.current?.getCamera().then((camera) => {
        camera.zoom -= 1; // 줌 아웃
        mapRef.current?.animateCamera(camera);
      });
    }
  };

  // 개발하는 동안 편하게 사용하는 미리 로드된 대중교통 데이터셋
  const fetchTransportData = async (dayIndex: number, placeIndex: number) => {
    try {
      if (transportInfo[dayIndex]?.[placeIndex]) {
        console.log(`이미 저장된 데이터: Day ${dayIndex}, Place ${placeIndex}`);
        console.log('저장된 transportInfo:', transportInfo[dayIndex]?.[placeIndex]);  // transportInfo 로그 출력
        return;  // 이미 데이터가 있으면 API 호출하지 않음
      }
  
      const startPlace = routeInfoByDay[`Day ${dayIndex + 1}`]?.visitPlaces[placeIndex];
      const endPlace = routeInfoByDay[`Day ${dayIndex + 1}`]?.visitPlaces[placeIndex + 1];
  
      if (!startPlace || !endPlace) return;
    
      const newTransportInfo : TransportInfo[] =  [
        {
          "mode": "WALK",
          "route": "도보",
          "routeColor": "#8A8F96",
          "startLocation": {
            "name": "출발지",
            "lon": 126.99463434,
            "lat": 37.53458875
          },
          "endLocation": {
            "name": "이태원",
            "lon": 126.99464166666667,
            "lat": 37.53454444444444
          },
          "sectionTime": 86,
          "steps": [
            {
              "streetName": "",
              "distance": 42,
              "linestring": [
                {
                  "latitude": 37.53454,
                  "longitude": 126.99464
                },
                {
                  "latitude": 37.53452,
                  "longitude": 126.99434
                },
                {
                  "latitude": 37.53451,
                  "longitude": 126.99417
                }
              ]
            },
            {
              "streetName": "",
              "distance": 24,
              "linestring": [
                {
                  "latitude": 37.53451,
                  "longitude": 126.99417
                },
                {
                  "latitude": 37.5346,
                  "longitude": 126.994156
                },
                {
                  "latitude": 37.534607,
                  "longitude": 126.99428
                },
                {
                  "latitude": 37.534637,
                  "longitude": 126.99431
                }
              ]
            },
            {
              "streetName": "이태원로",
              "distance": 29,
              "linestring": [
                {
                  "latitude": 37.534637,
                  "longitude": 126.99431
                },
                {
                  "latitude": 37.534637,
                  "longitude": 126.99437
                },
                {
                  "latitude": 37.534637,
                  "longitude": 126.994446
                },
                {
                  "latitude": 37.534637,
                  "longitude": 126.99449
                },
                {
                  "latitude": 37.53465,
                  "longitude": 126.99463
                }
              ]
            }
          ],
          "passShape": [],
          "totalTime": 713,
          "totalFare": 1400,
          "transferCount": 0,
          "totalDistance": 2121,
          "totalWalkTime": 477
        },
        {
          "mode": "SUBWAY",
          "route": "수도권6호선",
          "routeColor": "CD7C2F",
          "startLocation": {
            "name": "이태원",
            "lon": 126.99464166666667,
            "lat": 37.53454444444444
          },
          "endLocation": {
            "name": "삼각지",
            "lon": 126.97394444444444,
            "lat": 37.53561111111111
          },
          "sectionTime": 236,
          "passStopList": [
            {
              "index": 0,
              "stationName": "이태원",
              "lon": 126.994642,
              "lat": 37.534544,
              "stationID": "110621"
            },
            {
              "index": 1,
              "stationName": "녹사평(용산구청)",
              "lon": 126.986864,
              "lat": 37.534594,
              "stationID": "110620"
            },
            {
              "index": 2,
              "stationName": "삼각지",
              "lon": 126.973944,
              "lat": 37.535611,
              "stationID": "110619"
            }
          ],
          "passShape": [
            {
              "latitude": 37.534542,
              "longitude": 126.994642
            },
            {
              "latitude": 37.534492,
              "longitude": 126.993856
            },
            {
              "latitude": 37.534344,
              "longitude": 126.991808
            },
            {
              "latitude": 37.534275,
              "longitude": 126.990661
            },
            {
              "latitude": 37.534178,
              "longitude": 126.989108
            },
            {
              "latitude": 37.534131,
              "longitude": 126.988533
            },
            {
              "latitude": 37.534128,
              "longitude": 126.988489
            },
            {
              "latitude": 37.534125,
              "longitude": 126.988447
            },
            {
              "latitude": 37.534122,
              "longitude": 126.988403
            },
            {
              "latitude": 37.534119,
              "longitude": 126.988358
            },
            {
              "latitude": 37.534119,
              "longitude": 126.988317
            },
            {
              "latitude": 37.534122,
              "longitude": 126.988272
            },
            {
              "latitude": 37.534125,
              "longitude": 126.988231
            },
            {
              "latitude": 37.534125,
              "longitude": 126.988186
            },
            {
              "latitude": 37.534131,
              "longitude": 126.988142
            },
            {
              "latitude": 37.534133,
              "longitude": 126.9881
            },
            {
              "latitude": 37.534139,
              "longitude": 126.988056
            },
            {
              "latitude": 37.534144,
              "longitude": 126.988014
            },
            {
              "latitude": 37.534153,
              "longitude": 126.987972
            },
            {
              "latitude": 37.534161,
              "longitude": 126.987928
            },
            {
              "latitude": 37.534169,
              "longitude": 126.987886
            },
            {
              "latitude": 37.534181,
              "longitude": 126.987844
            },
            {
              "latitude": 37.534192,
              "longitude": 126.987806
            },
            {
              "latitude": 37.534203,
              "longitude": 126.987764
            },
            {
              "latitude": 37.534217,
              "longitude": 126.987722
            },
            {
              "latitude": 37.534231,
              "longitude": 126.987683
            },
            {
              "latitude": 37.534244,
              "longitude": 126.987644
            },
            {
              "latitude": 37.534583,
              "longitude": 126.9869
            },
            {
              "latitude": 37.534594,
              "longitude": 126.986864
            },
            {
              "latitude": 37.534881,
              "longitude": 126.985964
            },
            {
              "latitude": 37.534889,
              "longitude": 126.985939
            },
            {
              "latitude": 37.534894,
              "longitude": 126.985908
            },
            {
              "latitude": 37.5349,
              "longitude": 126.985881
            },
            {
              "latitude": 37.534906,
              "longitude": 126.985853
            },
            {
              "latitude": 37.534911,
              "longitude": 126.985825
            },
            {
              "latitude": 37.534917,
              "longitude": 126.985797
            },
            {
              "latitude": 37.534919,
              "longitude": 126.985769
            },
            {
              "latitude": 37.534925,
              "longitude": 126.985742
            },
            {
              "latitude": 37.534928,
              "longitude": 126.985714
            },
            {
              "latitude": 37.534931,
              "longitude": 126.985683
            },
            {
              "latitude": 37.534933,
              "longitude": 126.985656
            },
            {
              "latitude": 37.534939,
              "longitude": 126.985628
            },
            {
              "latitude": 37.534939,
              "longitude": 126.985597
            },
            {
              "latitude": 37.534942,
              "longitude": 126.985569
            },
            {
              "latitude": 37.534942,
              "longitude": 126.985539
            },
            {
              "latitude": 37.534942,
              "longitude": 126.985511
            },
            {
              "latitude": 37.534944,
              "longitude": 126.985483
            },
            {
              "latitude": 37.534944,
              "longitude": 126.985453
            },
            {
              "latitude": 37.534942,
              "longitude": 126.985425
            },
            {
              "latitude": 37.534942,
              "longitude": 126.985394
            },
            {
              "latitude": 37.534942,
              "longitude": 126.985367
            },
            {
              "latitude": 37.534783,
              "longitude": 126.98115
            },
            {
              "latitude": 37.534678,
              "longitude": 126.977556
            },
            {
              "latitude": 37.534647,
              "longitude": 126.976092
            },
            {
              "latitude": 37.534644,
              "longitude": 126.976064
            },
            {
              "latitude": 37.534644,
              "longitude": 126.976033
            },
            {
              "latitude": 37.534644,
              "longitude": 126.976003
            },
            {
              "latitude": 37.534647,
              "longitude": 126.975975
            },
            {
              "latitude": 37.534647,
              "longitude": 126.975944
            },
            {
              "latitude": 37.53465,
              "longitude": 126.975917
            },
            {
              "latitude": 37.534653,
              "longitude": 126.975886
            },
            {
              "latitude": 37.534656,
              "longitude": 126.975856
            },
            {
              "latitude": 37.534661,
              "longitude": 126.975828
            },
            {
              "latitude": 37.534667,
              "longitude": 126.9758
            },
            {
              "latitude": 37.534672,
              "longitude": 126.975769
            },
            {
              "latitude": 37.534678,
              "longitude": 126.975742
            },
            {
              "latitude": 37.534686,
              "longitude": 126.975714
            },
            {
              "latitude": 37.534692,
              "longitude": 126.975683
            },
            {
              "latitude": 37.534703,
              "longitude": 126.975658
            },
            {
              "latitude": 37.534711,
              "longitude": 126.975631
            },
            {
              "latitude": 37.534719,
              "longitude": 126.975603
            },
            {
              "latitude": 37.534731,
              "longitude": 126.975578
            },
            {
              "latitude": 37.534742,
              "longitude": 126.97555
            },
            {
              "latitude": 37.534753,
              "longitude": 126.975525
            },
            {
              "latitude": 37.534764,
              "longitude": 126.9755
            },
            {
              "latitude": 37.535019,
              "longitude": 126.975078
            },
            {
              "latitude": 37.535125,
              "longitude": 126.974892
            },
            {
              "latitude": 37.535606,
              "longitude": 126.973989
            },
            {
              "latitude": 37.535606,
              "longitude": 126.973986
            },
            {
              "latitude": 37.535622,
              "longitude": 126.973953
            }
          ],
          "totalTime": 713,
          "totalFare": 1400,
          "transferCount": 0,
          "totalDistance": 2121,
          "totalWalkTime": 477
        },
        {
          "mode": "WALK",
          "route": "도보",
          "routeColor": "#8A8F96",
          "startLocation": {
            "name": "삼각지",
            "lon": 126.97394444444444,
            "lat": 37.53561111111111
          },
          "endLocation": {
            "name": "도착지",
            "lon": 126.97701646,
            "lat": 37.53624102
          },
          "sectionTime": 391,
          "steps": [
            {
              "streetName": "",
              "distance": 37,
              "linestring": [
                {
                  "latitude": 37.535618,
                  "longitude": 126.973946
                },
                {
                  "latitude": 37.5356,
                  "longitude": 126.97399
                },
                {
                  "latitude": 37.53557,
                  "longitude": 126.97405
                },
                {
                  "latitude": 37.535442,
                  "longitude": 126.9743
                }
              ]
            },
            {
              "streetName": "",
              "distance": 45,
              "linestring": [
                {
                  "latitude": 37.535442,
                  "longitude": 126.9743
                },
                {
                  "latitude": 37.53569,
                  "longitude": 126.9747
                }
              ]
            },
            {
              "streetName": "",
              "distance": 19,
              "linestring": [
                {
                  "latitude": 37.53569,
                  "longitude": 126.9747
                },
                {
                  "latitude": 37.535618,
                  "longitude": 126.97472
                },
                {
                  "latitude": 37.535553,
                  "longitude": 126.97475
                },
                {
                  "latitude": 37.535534,
                  "longitude": 126.97478
                }
              ]
            },
            {
              "streetName": "한강대로",
              "distance": 5,
              "linestring": [
                {
                  "latitude": 37.535534,
                  "longitude": 126.97478
                },
                {
                  "latitude": 37.535496,
                  "longitude": 126.97481
                }
              ]
            },
            {
              "streetName": "",
              "distance": 121,
              "linestring": [
                {
                  "latitude": 37.53476,
                  "longitude": 126.976135
                },
                {
                  "latitude": 37.534866,
                  "longitude": 126.97619
                },
                {
                  "latitude": 37.53493,
                  "longitude": 126.976234
                },
                {
                  "latitude": 37.535,
                  "longitude": 126.97632
                },
                {
                  "latitude": 37.53509,
                  "longitude": 126.97645
                },
                {
                  "latitude": 37.53518,
                  "longitude": 126.97657
                },
                {
                  "latitude": 37.535248,
                  "longitude": 126.976746
                },
                {
                  "latitude": 37.535286,
                  "longitude": 126.976845
                },
                {
                  "latitude": 37.535294,
                  "longitude": 126.97708
                },
                {
                  "latitude": 37.5353,
                  "longitude": 126.97721
                }
              ]
            },
            {
              "streetName": "",
              "distance": 84,
              "linestring": [
                {
                  "latitude": 37.5353,
                  "longitude": 126.97721
                },
                {
                  "latitude": 37.535416,
                  "longitude": 126.97718
                },
                {
                  "latitude": 37.536057,
                  "longitude": 126.97715
                }
              ]
            },
            {
              "streetName": "보행자도로",
              "distance": 11,
              "linestring": [
                {
                  "latitude": 37.536057,
                  "longitude": 126.97715
                },
                {
                  "latitude": 37.536053,
                  "longitude": 126.97703
                }
              ]
            }
          ],
          "passShape": [],
          "totalTime": 713,
          "totalFare": 1400,
          "transferCount": 0,
          "totalDistance": 2121,
          "totalWalkTime": 477
        }
      ]

      // 교통 정보를 각 Day와 장소에 따라 상태에 저장
      setTransportInfo((prevInfo) => {
        const updatedInfo = [...prevInfo];  // 기존 배열 복사
        if (!updatedInfo[dayIndex]) {
          updatedInfo[dayIndex] = [];  // 해당 dayIndex에 배열이 없으면 초기화
        }
        updatedInfo[dayIndex][placeIndex] = newTransportInfo;  // 각 장소에 맞는 정보를 배열로 저장
        return updatedInfo;
        });
    } catch (error) {
      console.error('Error fetching TMap transport data:', error);
      Alert.alert('Error', '교통 데이터를 불러오는 중 오류가 발생했습니다.');
    }
  };

  // 실제 api 호출해서 사용
  const fetchTransportData1 = async (dayIndex: number, placeIndex: number) => {
    try {
      // 이미 저장된 데이터가 있는지 확인
      if (transportInfo[dayIndex]?.[placeIndex]) {
        console.log(`이미 저장된 데이터: Day ${dayIndex}, Place ${placeIndex}`);
        return;
      }
  
      // 출발지와 도착지 정보 가져오기
      const startPlace = routeInfoByDay[`Day ${dayIndex + 1}`]?.visitPlaces[placeIndex];
      const endPlace = routeInfoByDay[`Day ${dayIndex + 1}`]?.visitPlaces[placeIndex + 1];
  
      if (!startPlace || !endPlace) return;
  
      // API 요청을 위한 requestBody 생성
      const requestBody = {
        startX: startPlace.longitude.toString(),
        startY: startPlace.latitude.toString(),
        endX: endPlace.longitude.toString(),
        endY: endPlace.latitude.toString(),
        count: 1,
        lang: 0,
        format: "json",
      };
  
      // 대중교통 API 호출
      const public_transport_response = await axios.post(
        'https://apis.openapi.sk.com/transit/routes',
        requestBody,
        {
          headers: {
            'Content-Type': 'application/json',
            'appKey': '', // 실제 API 키
          },
        }
      );
  
      console.log("대중교통 API 응답", public_transport_response);
  
      const status = public_transport_response.data.result?.status;
      const itineraries: Itinerary[] = public_transport_response.data.metaData?.plan?.itineraries || [];
  
      // API 응답에서 오류가 있거나 유효한 데이터가 없는 경우 처리
      if ([11, 12, 13, 14].includes(status) || itineraries.length === 0) {
        console.log(`T MAP 대중교통 API 오류: 코드(${status}), 메시지(${public_transport_response.data.result?.message || "No public transport data available"})`);
        setTransportInfo((prevInfo) => {
          const updatedInfo = [...prevInfo];
          updatedInfo[dayIndex] = updatedInfo[dayIndex] || [];
          updatedInfo[dayIndex][placeIndex] = []; // 빈 배열로 처리
          return updatedInfo;
        });
        return;
      }
  
      // 새로운 TransportInfo 배열 생성
      const newTransportInfo: TransportInfo[] = [];
  
      // 각 경로에 대한 정보를 TransportInfo로 변환
      itineraries.forEach((itinerary) => {
        const totalFare = itinerary.fare?.regular?.totalFare ?? 0;
        const totalWalkTime = itinerary.totalWalkTime ?? 0;
        const totalTime = itinerary.totalTime ?? 0;
        const transferCount = itinerary.transferCount ?? 0;
        const totalDistance = itinerary.totalDistance ?? 0;
  
        itinerary.legs?.forEach((leg: Leg) => {
          const transportDetails: TransportInfo = {
            mode: leg.mode || 'UNKNOWN',
            route: leg.route || '도보',
            routeColor: leg.routeColor || '#8A8F96',
  
            startLocation: {
              name: leg.start?.name || "-",
              lon: leg.start?.lon ?? 0,
              lat: leg.start?.lat ?? 0,
            },
            endLocation: {
              name: leg.end?.name || "-",
              lon: leg.end?.lon ?? 0,
              lat: leg.end?.lat ?? 0,
            },
            sectionTime: leg.sectionTime ?? 0,
  
            // WALK가 아닐 때는 passStopList로 처리
            passStopList: leg.mode !== 'WALK' ? leg.passStopList?.stationList?.map((station) => ({
              index: station.index ?? 0,
              stationName: station.stationName || "-",
              lon: parseFloat(station.lon || "0"),
              lat: parseFloat(station.lat || "0"),
              stationID: station.stationID || "-",
            })) || [] : undefined,
  
            // WALK일 때는 steps 배열로 처리
            steps: leg.mode === 'WALK' ? leg.steps?.map(step => ({
              streetName: step.streetName,
              distance: step.distance,
              linestring: step.linestring 
                ? step.linestring.split(" ").map(coord => {
                    const [lon, lat] = coord.split(",");
                    return { latitude: parseFloat(lat), longitude: parseFloat(lon) };
                  })
                : [],  // linestring이 없을 경우 빈 배열 반환
            })) : undefined,         
  
            passShape: leg.passShape?.linestring
              ? leg.passShape.linestring.split(" ").map((coord) => {
                const [lon, lat] = coord.split(",");
                return { latitude: parseFloat(lat), longitude: parseFloat(lon) };
              })
              : [],
  
            totalTime,
            totalFare,
            transferCount,
            totalDistance,
            totalWalkTime,
          };
  
          newTransportInfo.push(transportDetails);
        });
      });
  
      // 새롭게 얻은 교통 정보를 transportInfo 상태에 저장
      setTransportInfo((prevInfo) => {
        const updatedInfo = [...prevInfo];
        updatedInfo[dayIndex] = updatedInfo[dayIndex] || [];
        updatedInfo[dayIndex][placeIndex] = newTransportInfo;
        return updatedInfo;
      });

      console.log("대중교통 가공된 API 응답", JSON.stringify(newTransportInfo, null, 2));
  
    } catch (error) {
      console.error('Error fetching TMap transport data:', error);
    }
  };
  

  // 날짜 계산 함수
  const getCalculatedDate = (baseDate: string, index: number): string => {
    // baseDate는 "24.10.1" 형식이므로, 이를 분리해서 계산
    const [year, month, day] = baseDate.split('.').map(Number);  // 숫자로 변환
    const newDay = day + index;  // index만큼 더한 날짜
    return `${year}.${month}.${newDay}`;  // 새로운 날짜 반환
  };

  const getMarkerImage = (selectedDayIndex: number, index: number) => {
    switch (selectedDayIndex) {
      case 0: // Day 1
        if (index === 0) return require('../../assets/images/route/marker/1_r.png');
        if (index === 1) return require('../../assets/images/route/marker/2_r.png');
        if (index === 2) return require('../../assets/images/route/marker/3_r.png');
        if (index === 3) return require('../../assets/images/route/marker/4_r.png');
        if (index === 4) return require('../../assets/images/route/marker/5_r.png');
        if (index === 5) return require('../../assets/images/route/marker/6_r.png');
        break;
      case 1: // Day 2
        if (index === 0) return require('../../assets/images/route/marker/1_o.png');
        if (index === 1) return require('../../assets/images/route/marker/2_o.png');
        if (index === 2) return require('../../assets/images/route/marker/3_o.png');
        if (index === 3) return require('../../assets/images/route/marker/4_o.png');
        if (index === 4) return require('../../assets/images/route/marker/5_o.png');
        if (index === 5) return require('../../assets/images/route/marker/6_r.png');
        break;
      case 2: // Day 3
      default:
        if (index === 0) return require('../../assets/images/route/marker/1_y.png');
        if (index === 1) return require('../../assets/images/route/marker/2_y.png');
        if (index === 2) return require('../../assets/images/route/marker/3_y.png');
        if (index === 3) return require('../../assets/images/route/marker/4_y.png');
        if (index === 4) return require('../../assets/images/route/marker/5_y.png');
        if (index === 5) return require('../../assets/images/route/marker/6_r.png');
        break;
    }
  };
  // 장소 클릭 시 지도의 중심을 이동하는 함수
  const handlePlaceClick = (latitude: number, longitude: number): void => {
    if (mapRef.current) {
      mapRef.current.animateToRegion({
        latitude: latitude,
        longitude: longitude,
        latitudeDelta: 0.01, // 줌 정도 설정
        longitudeDelta: 0.01,
      }, 1000); // 1초 동안 애니메이션
    }
  };

  // <- 화살표 버튼을 눌렀을 때 나가기 경고창 띄우기
  const handleBackPress = () => {
    Alert.alert(
      '테마 화면으로 돌아가기',
      '현재 페이지를 나가시면 다시 볼 수 없습니다. 나가시겠습니까?',
      [
        {
          text: '취소',
          style: 'cancel',
        },
        {
          text: '나가기',
          onPress: () => navigation.navigate('Tabs'), // 나가기 버튼 클릭시 Tabs로 이동
        },
      ],
      { cancelable: true },
    );
  };

  return (
    <GestureHandlerRootView style={styles.container}>
      <MapView
        ref={mapRef}
        style={StyleSheet.absoluteFillObject}
        initialRegion={{
          latitude: 37.562004, // 초기 지도 위치
          longitude: 126.975208,
          latitudeDelta: 0.04,
          longitudeDelta: 0.04,
        }}
        showsUserLocation={true}
        showsMyLocationButton={false} // 현재 위치 버튼을 숨김
      >
        {/* 장소 마커 찍기 */}
        {routeInfoByDay[`Day ${selectedDayIndex + 1}`]?.visitPlaces?.map((place, index) => {
          // 장소 번호와 현재 일수에 따라 미리 로드된 이미지 경로 설정
          let markerImage;

          switch (selectedDayIndex) {
            case 0: // Day 1
              markerImage = index === 0 ? require('../../assets/images/route/marker/1_r.png') : 
                index === 1 ? require('../../assets/images/route/marker/2_r.png') :
                index === 2 ? require('../../assets/images/route/marker/3_r.png') :
                index === 3 ? require('../../assets/images/route/marker/4_r.png') :
                index === 4 ? require('../../assets/images/route/marker/5_r.png') :
                require('../../assets/images/route/marker/6_r.png');
              break;
            case 1: // Day 2
              markerImage = index === 0 ? require('../../assets/images/route/marker/1_o.png') :
                index === 1 ? require('../../assets/images/route/marker/2_o.png') :
                index === 2 ? require('../../assets/images/route/marker/3_o.png') :
                index === 3 ? require('../../assets/images/route/marker/4_o.png') :
                index === 4 ? require('../../assets/images/route/marker/5_o.png') :
                require('../../assets/images/route/marker/6_o.png');
              break;
            case 2: // Day 3
            default:
              markerImage = index === 0 ? require('../../assets/images/route/marker/1_y.png') :
                index === 1 ? require('../../assets/images/route/marker/2_y.png') :
                index === 2 ? require('../../assets/images/route/marker/3_y.png') :
                index === 3 ? require('../../assets/images/route/marker/4_y.png') :
                index === 4 ? require('../../assets/images/route/marker/5_y.png') :
                require('../../assets/images/route/marker/6_y.png');
              break;
          }

          return (
            <Marker
              key={index}
              coordinate={{
                latitude: parseFloat(place.latitude.toString()) || 0,
                longitude: parseFloat(place.longitude.toString()) || 0,
              }}
              title={`${index + 1}. ${place.name}`} // 순서와 장소명 함께 표시
              image={markerImage} // 마커 이미지 설정
            >
              <Callout>
                <Text>{place.name || "Unnamed Place"}</Text>
              </Callout>
            </Marker>
          );
        })}

        {/* 경로 표시 */}
        {transportInfo[selectedDayIndex]?.map((placeInfo, placeIndex) => {
          const toggleKey = `${selectedDayIndex}-${placeIndex}`;

          return (
            toggleState[toggleKey] && (
              <React.Fragment key={placeIndex}>
                {placeInfo?.map((info, transportIndex) => (
                  <React.Fragment key={`transport-${placeIndex}-${transportIndex}`}>
                    {/* 출발지 마커 (첫 번째 인덱스는 찍지 않음) */}
                    {transportIndex !== 0 && (
                      <Marker
                        key={`start-marker-${placeIndex}-${transportIndex}`}
                        coordinate={{
                          latitude: info.startLocation?.lat || 0,
                          longitude: info.startLocation?.lon || 0,
                        }}
                        // title={`출발: ${info.startLocation?.name}`}
                      >
                        {/* 가운데가 뚫린 커스텀 원 모양 */}
                        <View
                          style={{
                            width: 30,
                            height: 30,
                            borderRadius: 15, // 원 모양 만들기
                            backgroundColor: info.routeColor ? `#${info.routeColor.replace('#', '')}`:'#8A8F96', // 가운데를 뚫기 위해 투명하게 설정
                          }}
                        />
                      </Marker>
                    )}

                    {/* 도착지 마커 (마지막 인덱스는 찍지 않음) */}
                    {transportIndex !== placeInfo.length - 1 && (
                      <Marker
                        key={`end-marker-${placeIndex}-${transportIndex}`}
                        coordinate={{
                          latitude: info.endLocation?.lat || 0,
                          longitude: info.endLocation?.lon || 0,
                        }}
                        // title={`도착: ${info.endLocation?.name}`}
                      >
                        {/* 가운데가 뚫린 커스텀 원 모양 */}
                        <View
                          style={{
                            width: 30,
                            height: 30,
                            borderRadius: 15, // 원 모양 만들기
                            backgroundColor: info.routeColor ? `#${info.routeColor.replace('#', '')}`:'#8A8F96', // 가운데를 뚫기 위해 투명하게 설정
                          }}
                        />
                      </Marker>
                    )}
                    {/* 정류장 마커 */}
                    {info.passStopList?.map((station, stationIndex) => (
                      <Marker
                        key={`station-marker-${placeIndex}-${stationIndex}`}
                        coordinate={{
                          latitude: station.lat || 0,
                          longitude: station.lon || 0,
                        }}
                        // title={station.stationName}
                        // pinColor='#8A8F96'
                      >
                        {/* 커스텀 원 모양 마커 */}
                        <View
                          style={{
                            width: 30,
                            height: 30,
                            borderRadius: 15, // 원 모양 만들기
                            borderWidth: 4,
                            borderColor: info.routeColor ? `#${info.routeColor.replace('#', '')}`:'#8A8F96', // 색상 지정
                            backgroundColor: 'transparent', // 가운데를 투명하게
                          }}
                        />
                        {/* 정류장 이름 표시 */}
                        <View style={{ alignItems: 'center', padding: 10 }}>
                          <Text style={{ fontSize: 12, fontWeight: 'bold', color: '#000' }}>
                            {station.stationName || '정류장 이름'}
                          </Text>
                        </View>
                      </Marker>
                    ))}

                    {/* Polyline 경로 */}
                    {info.mode === 'WALK' && info.steps ? (
                      // WALK일 때는 steps로 경로 표시
                      info.steps.map((step, stepIndex) => (
                        <Polyline
                          key={`walk-line-${placeIndex}-${stepIndex}`}
                          coordinates={
                            step.linestring
                              ?.filter(coord => coord.latitude !== undefined && coord.longitude !== undefined) // 좌표가 존재하는지 필터링
                              .map(coord => ({
                                latitude: coord.latitude || 0, // 기본값을 0으로 설정
                                longitude: coord.longitude || 0, // 기본값을 0으로 설정
                              })) || []
                          }
                          strokeColor='#000000'
                          strokeWidth={4}
                          lineDashPattern={[2, 10]} // 점선 패턴 (선길이, 간격)
                          zIndex={0}
                        />
                      ))
                    ) : (
                      // 다른 교통수단일 때는 passShape로 경로 표시
                      info.passShape && info.passShape.length > 0 && (
                        <Polyline
                          coordinates={
                            info.passShape
                              ?.filter(coord => coord.latitude !== undefined && coord.longitude !== undefined) // 좌표가 undefined가 아닌 값만 필터링
                              .map(coord => ({
                                latitude: coord.latitude || 0, // 기본값을 0으로 설정
                                longitude: coord.longitude || 0, // 기본값을 0으로 설정
                              })) || []  // 기본적으로 빈 배열을 반환하여 오류 방지
                          }
                          strokeColor={info.routeColor ? `#${info.routeColor.replace('#', '')}` : '#0047A0'}
                          strokeWidth={4}
                          zIndex={0}
                        />
                      )
                    )}
                  </React.Fragment>
                ))}
              </React.Fragment>
            )
          );
        })}
      </MapView>


      <View style={styles.zoomButtonsContainer}>
        <TouchableOpacity style={styles.zoomButton} onPress={handleZoomIn}>
          <Text style={styles.zoomButtonText}>+</Text>
        </TouchableOpacity>
        <TouchableOpacity style={styles.zoomButton} onPress={handleZoomOut}>
          <Text style={styles.zoomButtonText}>-</Text>
        </TouchableOpacity>
      </View>
      <TouchableOpacity onPress={handleBackPress} style={styles.backButton}>
        <Image source={require('../../assets/images/back_button3.png')} style={styles.backButtonImage} />
      </TouchableOpacity>
      <BottomSheet ref={bottomSheetRef} index={2} snapPoints={['10%', '25%', '50%', '90%']}>
        {/* 1. Day1, Day2, Day3 버튼을 상단에 추가 */}
        <ScrollView contentContainerStyle={styles.bottomSheetContent}>
          <View style={styles.dayButtonsContainer}>
            {Array.from({ length: dayCount }).map((_, index) => (
              <TouchableOpacity
                key={index}
                onPress={() => {
                  setSelectedDayIndex(index); // 선택한 날짜 인덱스 업데이트
                  const firstPlace = routeInfoByDay[`Day ${index + 1}`]?.visitPlaces?.[0]; // 첫 번째 장소 가져오기
                  if (firstPlace) {
                    handlePlaceClick(firstPlace.latitude, firstPlace.longitude); // 지도 중심 이동
                  }
                }}
                style={[styles.dayButton, selectedDayIndex === index && styles.selectedDayButton]}
              >
                <Text style={selectedDayIndex === index ? styles.selectedDayText : styles.dayButtonText}>
                  {`Day ${index + 1}`}
                </Text>
              </TouchableOpacity>
            ))}
          </View>

          {/* 2. 장소 리스트와 동그라미 마커 */}
          <View style={styles.timelineContainer}>
            {routeInfoByDay[`Day ${selectedDayIndex + 1}`]?.visitPlaces?.map((place, index) => {
              // toggleKey 선언
              const toggleKey = `${selectedDayIndex}-${index}`;

              return (
                <View key={index} style={styles.timelineItem}>
                  <View style={{ flexDirection: 'column', alignItems: 'flex-start' }}>
                    {/* 2.1 동그라미 마커와 장소명 */}
                    <TouchableOpacity onPress={() => handlePlaceClick(place.latitude, place.longitude)} style={styles.markerAndPlaceContainer}>
                      <View style={styles.markerContainer}>
                        <Image source={getMarkerImage(selectedDayIndex, index)} style={styles.markerImage} />
                      </View>
                      <Text style={styles.placeNameText}>{place.name}</Text>
                    </TouchableOpacity>
                  </View>
                  {/* 2.1 세로줄 (markerAndPlaceContainer의 외부에 배치) */}
                  <View style={[
                      styles.verticalLine,
                      toggleState[toggleKey] && styles.expandedVerticalLine,  // 토글 상태에 따라 세로선 높이 확장
                    ]} />
                  {/* 2.2 마커 사이에 세로줄과 교통수단 아이콘 & 텍스트 & 토글 */}
                  {index < routeInfoByDay[`Day ${selectedDayIndex + 1}`]?.visitPlaces?.length - 1 && (
                    <View style={[
                      styles.lineAndTransportContainer,
                      toggleState[toggleKey] && styles.expandedLineAndTransportContainer  // 토글 상태에 따라 높이 확장
                    ]}>
                      <TouchableOpacity
                        onPress={() => {
                          toggleItem(selectedDayIndex, index);                
                        }}
                        style={[
                          styles.transportToggleContainer,
                          toggleState[toggleKey] && styles.expandedContainer  // 토글 상태에 따라 공간 확장
                        ]}
                      >
                        <View style={styles.transportContent}>
                          {/* 교통수단 아이콘 */}
                          <Image
                            source={selectedVehicle === 0
                              ? require('../../assets/images/route/timeline-bus.png')
                              : require('../../assets/images/route/timeline-car.png')}
                            style={styles.transportIcon}
                          />
                          <Text style={styles.toggleButtonText}>
                            {toggleState[toggleKey] ? 'v 경로 닫기' : '> 경로 보기'}
                          </Text>
                        </View>
                        {/* 토글 상태가 true일 때만 추가 정보 표시 */}
                        {toggleState[toggleKey] && transportInfo[selectedDayIndex]?.[index] && (
                          <View style={styles.expandedContent}>
                            {/* transportInfo가 빈 배열이거나 경우도 체크 */}
                            {Array.isArray(transportInfo[selectedDayIndex]?.[index]) && transportInfo[selectedDayIndex]?.[index].length === 0 ? (
                              <Text style={styles.noTransportInfoText}>대중교통 정보가 없습니다.</Text>
                            ) : (
                              <>
                                {/* 추가 정보들 */}
                                {/* 첫 번째 줄 */}
                                <Text style={styles.transportTimeText}>
                                  {`총 소요시간: ${Math.floor((transportInfo[selectedDayIndex]?.[index]?.[0]?.totalTime ?? 0) / 60)}m, 대중교통 요금: ${transportInfo[selectedDayIndex]?.[index]?.[0]?.totalFare ?? 0}원`}
                                </Text>

                                {/* 두 번째 줄 */}
                                <Text style={styles.transportTimeText}>
                                  {`환승 횟수: ${transportInfo[selectedDayIndex]?.[index]?.[0]?.transferCount ?? 0}번, 총 보행시간: ${Math.floor((transportInfo[selectedDayIndex]?.[index]?.[0]?.totalWalkTime ?? 0) / 60)}m`}
                                </Text>

                                {/* 세 번째 줄 */}
                                {/* 교통수단에 따른 캡슐 형태의 정보 표시 */}
                                <View style={styles.capsuleGroup}>
                                  {transportInfo[selectedDayIndex]?.[index]?.map((info: TransportInfo, subIndex: number) => {
                                    const totalSectionTime = transportInfo[selectedDayIndex][index]
                                      .reduce((sum, current) => sum + current.sectionTime, 0); // 전체 시간 합계 계산
                                    const totalCapsuleWidth = 280; // 고정된 전체 타임캡슐 너비 (px 단위)
                                    const sectionWidth = (info.sectionTime / totalSectionTime) * totalCapsuleWidth; // 각 구간의 비율에 따른 실제 너비 계산 (숫자형 값)

                                    return (
                                      <View key={subIndex} style={[styles.capsuleContainer, { width: sectionWidth }]}>
                                        {info.mode !== 'WALK' ? (
                                          // WALK가 아닌 경우, 캡슐 모양 표시
                                          <View
                                            style={[
                                              styles.capsule,
                                              {
                                                width: sectionWidth,
                                                borderRadius:20,
                                                height: 35,
                                                backgroundColor: info.routeColor
                                                  ? `#${info.routeColor?.replace(' ', '')}` // routeColor가 있으면 적용
                                                  : '#0A0A0A', // routeColor가 없으면 기본값 #0A0A0A
                                              },
                                            ]}
                                          >
                                            <Text
                                              style={styles.capsuleText}
                                            >
                                              {`${Math.floor(info.sectionTime / 60)}m`} {/* 분으로 변환 */}
                                            </Text>
                                          </View>
                                        ) : (
                                          // WALK인 경우, 캡슐은 표시하지 않고 시간만 텍스트로 표시
                                          <Text style={styles.walkTimeText}>
                                            {`${Math.floor(info.sectionTime / 60)}m`}
                                          </Text>
                                        )}
                                        {/* 각 교통수단의 정가운데에 route 표시 */}
                                        {/* {info.mode !== 'WALK' && (
                                          <Text style={styles.capsuleRouteText}>
                                            {`BUS ${info.route}`}
                                          </Text>
                                        )} */}
                                      </View>
                                    );
                                  })}
                                </View>

                                {/* 네 번째 줄 */}
                                {/* 출발지와 도착지 정보를 반복적으로 표시 */}
                                <View style={styles.stopsGroup}>
                                  {/* 세로선 추가 */}
                                  <View style={styles.transport_verticalLine} />

                                  {transportInfo[selectedDayIndex]?.[index]?.map((info: TransportInfo, subIndex: number) => {
                                    // WALK가 아닌 경우에만 출발지와 도착지를 표시
                                    if (info.mode !== 'WALK') {
                                      return (
                                        <View key={subIndex}>
                                          <Text style={[styles.stopText, {marginBottom: 15, fontFamily: 'SBAggroM'}]}>{`${info.mode} ${info.route}`}</Text>
                                          {/* 출발지 표시 */}
                                          <View style={styles.stopContainer}>
                                            <View style={styles.stopDotContainer}>
                                              <View
                                                style={[
                                                  styles.stopDot,
                                                  {
                                                    backgroundColor: `#${info.routeColor?.replace('#', '') || 'B0ADAD'}`,  // BUS 또는 SUBWAY인 경우 색깔 적용, 없으면 기본값
                                                  },
                                                ]}
                                              />
                                            </View>
                                            {/* 동그라미 옆에 route 표시 후 출발지 표시 */}
                                            <Text style={styles.stopText}>{`${info.startLocation?.name} 승차`}</Text>
                                          </View>

                                          {/* 도착지 표시 */}
                                          <View style={styles.stopContainer}>
                                            <View style={styles.stopDotContainer}>
                                              <View
                                                style={[
                                                  styles.stopDot,
                                                  {
                                                    backgroundColor: `#${info.routeColor?.replace('#', '') || 'B0ADAD'}`,  // BUS 또는 SUBWAY인 경우 색깔 적용, 없으면 기본값
                                                  },
                                                ]}
                                              />
                                            </View>
                                            {/* 동그라미 옆에 route 표시 후 도착지 표시 */}
                                            <Text style={styles.stopText}>{`${info.endLocation?.name} 하차`}</Text>
                                          </View>
                                        </View>
                                      );
                                    }
                                    return null;  // WALK일 경우 아무것도 반환하지 않음
                                  })}
                                </View>
                              </>
                            )}
                          </View>
                        )}
                      </TouchableOpacity>
                    </View>
                  )}
                </View>
              );
            })}
          </View>

          {/* 3. 선택된 날짜를 우측 하단에 표시 */}
          <View style={{ position: 'absolute', top: 85, right: 50 }}>
            {typeof contextSelectedDay[0] === 'string' && (
              <Text style={{ color: '#000000', fontFamily: 'SBAggroM', fontSize: 12 }}>
                {getCalculatedDate(contextSelectedDay[0] as string, selectedDayIndex)}
              </Text>
            )}
          </View>
        </ScrollView>
      </BottomSheet>
    </GestureHandlerRootView>
  );
};
const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  bottomSheetHeader: {
    flexDirection: 'row',
    justifyContent: 'space-around',
    padding: 10,
  },
  dayButton: {
    paddingVertical: 8,
    paddingHorizontal: 16,
    borderRadius: 20,
  },
  dayButtonText: {
    fontSize: 16,
    color: '#333',
    fontFamily: 'SBAggroM',
  },
  selectedDayButton: {
    backgroundColor: '#0047A0',
  },
  selectedDayText: {
    fontSize: 16,
    color: '#fff',
    fontFamily: 'SBAggroM',
  },
  dayContainer: {
    padding: 10,
  },
  itemContainer: {
    flexDirection: 'row',
    marginBottom: 10,
    alignItems: 'center',
  },
  timelineContainer: {
    flexDirection: 'column',
    padding: 10,
  },
  timelineItem: {
    flexDirection: 'column',
    alignItems: 'flex-start', // 마커와 장소명을 상단에 맞춤
    marginBottom: 10, // 기본 간격
  },
  markerAndLineContainer: {
    flexDirection: 'row',
    alignItems: 'center',
  },
  itemTitle: {
    fontSize: 16,
    fontWeight: 'bold',
    marginBottom: 5,
  },
  travelTime: {
    color: '#666',
    fontSize: 12,
  },
  timeline: {
    alignItems: 'center',
  },
  transportIcon: {
    width: 32,
    height: 32,
    marginRight: 10,
  },
  transportTimeText: {
    fontSize: 14,
    marginRight: 5,
    marginBottom: 9,  // 두 줄 사이의 간격을 위해 추가
    color: '#000000',
    fontFamily: 'SBAggroL',
  },
  toggleButtonText: {
    fontSize: 16,
    color: '#000000',
    fontFamily: 'SBAggroM',
  },
  emptySpace: {
    height: 50,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: '#f0f0f0',
  },
  zoomButtonsContainer: {
    position: 'absolute',
    top: 50,
    right: 20,
    alignItems: 'center',
  },
  zoomButton: {
    backgroundColor: 'white',
    padding: 10,
    borderRadius: 5,
    marginTop: 10,
    elevation: 5,
    shadowColor: 'black',
    shadowOpacity: 0.2,
    shadowRadius: 5,
    shadowOffset: { height: 1, width: 1 },
  },
  zoomButtonText: {
    fontSize: 20,
    fontWeight: 'bold',
    fontFamily: 'SBAggroM',
  },
  placeInfo: {
    flex: 1,
    justifyContent: 'center',
  },
  dayButtonsContainer: {
    flexDirection: 'row',
    justifyContent: 'space-around',
    padding: 10,
  },
  verticalLineAndIconContainer: {
    alignItems: 'center',
    flexDirection: 'column',
    justifyContent: 'center',
  },
  markerAndPlaceContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    zIndex: 1,               // 세로선 위에 배치
  },
  placeNameText: {
    marginLeft: 10,
    fontSize: 16,
    fontFamily: 'SBAggroM',
    color: '#000000',
  },
  backButton: {
    position: 'absolute',
    top: 30,
    left: 20,
    zIndex: 999,
    margin: 10,
  },
  backButtonImage: {
    width: 30,
    height: 30,
  },
  additionalText: {
    fontSize: 14,
    color: '#333',
    fontFamily: 'SBAggroM',
  },
  additionalTextContainer: {
    marginTop: 5, // 기본 텍스트와 추가 텍스트 사이의 간격
    paddingHorizontal: 16,
    paddingVertical: 8,
    backgroundColor: '#f0f0f0',
    borderRadius: 10,
  },
  bottomSheetContent: {
    padding: 10,
  },
  markerImage: {
    width: 40,
    height: 40,
  },
  verticalLine: {
    position: 'absolute',
    top: '70%',  // 부모 요소의 상단부터 시작
    left: 24,    // X축에서 마커와 일치하는 위치 (필요에 따라 조정)
    width: 4,
    height: 100,  
    backgroundColor: '#B5B5B5',
    zIndex: -1,  // 마커 뒤로 배치
    transform: [{ translateY: -25 }],  // Y축에서 중앙 정렬을 위한 보정
  },
  transport_verticalLine: {
    position: 'absolute',
    top: 30,
    bottom: 0,             // 부모 요소의 높이에 맞게 확장
    left: 9,              // 동그라미의 x좌표에 맞춰서 선 위치 고정 (조정 가능)
    width: 2,              // 선의 두께
    height: '50%', 
    backgroundColor: '#EAEBF0',  // 선의 색상
    zIndex: -1,            // 동그라미보다 뒤에 표시되도록 설정
  },
  transportContent: {
    flexDirection: 'row',
    alignItems: 'center',
    marginLeft: 50,
    marginBottom: 10
  },
  markerContainer: {
    width: 50,
    alignItems: 'center',
    justifyContent: 'center',
  },
  transportToggleContainer: {
    flexDirection: 'column',
    alignItems: 'flex-start',
    justifyContent: 'flex-start',
    overflow: 'hidden', // 넘치는 내용을 숨기기 위해 설정
  },
  expandedContent: {
    paddingHorizontal: 16,
    paddingVertical: 10,
    borderRadius: 10,
    marginTop: 5,
    marginLeft: 50,
  },
  capsuleGroup: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    width: '90%',  // 전체 타임캡슐 그룹 너비 고정
    height: 35,  // 고정된 높이
    borderRadius: 20,  // 전체적으로 둥근 모서리
    marginTop: 20,
    marginBottom: 28,
    padding: 5,
    backgroundColor: '#E5EAF0',  // 전체 캡슐의 배경색
  },
  capsuleContainer: {
    justifyContent: 'center',
    alignItems: 'center',
    height: 30,
  },
  capsule: {
    justifyContent: 'center',
    alignItems: 'center',
    paddingVertical: 5,
    borderRadius: 20,  // 네 모서리가 둥근 직사각형
    height: '100%', // 부모 컨테이너에 맞춤
  },
  capsuleText: {
    fontSize: 14,
    fontWeight: 'bold',
    color: '#E5EAF0',  // 기본 텍스트 색상은 흰색
  },
  walkTimeText: {
    fontSize: 14,
    fontWeight: 'bold',
    color: '#000',  // WALK는 검정색 텍스트
  },
  capsuleLabel: {
    marginTop: 14,
    textAlign: 'center',
    fontSize: 12,
    color: '#000',
    fontFamily: 'SBAggroM'
  },
  stopsGroup: {
    position: 'relative',  // 자식 요소의 절대 위치를 위해 설정
  },
  stopContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 20,
  },
  stopDotContainer: {
    marginRight: 10,
    alignItems: 'center',
  },
  stopDot: {
    width: 20,
    height: 20,
    borderRadius: 10,
    backgroundColor: '#B5B5B5', // 동그라미 색상
  },
  stopText: {
    fontSize: 14,
    color: '#000',
    fontFamily: 'SBAggroL'
  },
  expandedLine: {
    height: 150, // 토글이 열렸을 때의 확장된 세로선 높이
  },
  lineAndTransportContainer: {
    flexDirection: 'column',   // 세로로 배치
    marginTop: 10,             // 마커와 교통 정보 사이 간격
    zIndex: 0,                 // 마커보다 뒤에 배치
  },
  expandedLineAndTransportContainer: {
    //flexGrow: 1,  // 자동 확장 대신 동적 높이 사용
    height: 'auto',  // 컨텐츠에 따라 자동으로 높이 조절
    marginBottom: 10,
    maxHeight: 300, // 최대 높이를 설정하여 스크롤이 가능하게 조정
    // minHeight: 500,  // 최소 높이 설정
    // maxHeight: 1600,  // 최대 높이 설정
    // overflow: 'hidden',  // 스크롤이 안되는 영역을 넘지 않도록 설정
  },
  expandedVerticalLine: {
    position: 'absolute',
    top: '10%',  // 부모 요소의 상단부터 시작
    left: 24,    // X축에서 마커와 일치하는 위치 (필요에 따라 조정)
    width: 4,
    height: '100%',  // 부모 컨테이너에 맞춰 높이를 동적으로 설정
    backgroundColor: '#B5B5B5',
    zIndex: -1,  // 마커 뒤로 배치
    transform: [{ translateY: -25 }],  // Y축에서 중앙 정렬을 위한 보정
  },
  expandedContainer: {
    flexGrow: 1,        // 자동 확장
    overflow: 'visible' // 넘치는 콘텐츠가 보이도록 설정
  },  
  noTransportInfoText: {
    fontSize: 16,
    color: '#000000', 
    textAlign: 'center',
    fontFamily: 'SBAggroL',
    marginTop: 10,
  },
  // capsuleRouteText: {
  //   position: 'absolute',   // 캡슐 위에 텍스트를 배치하기 위해 절대 위치 지정
  //   top: -25,               // 캡슐 위쪽에 위치시키기 위해 top을 -20으로 조정
  //   width: '100%',          // 텍스트가 캡슐 중앙에 오도록 전체 너비 사용
  //   textAlign: 'center',    // 텍스트를 중앙 정렬
  //   fontSize: 12,           // 폰트 크기 설정
  //   color: '#000',          // 텍스트 색상 (검정으로 지정)
  //   fontFamily: 'SBAggroM', // 폰트 스타일 적용
  // },  
});


export default RouteScreen;